/*

Moot v1.7.6 (beta) | Oct 4, 2013

"Forums and Commenting re-imagined"

https://moot.it | (c) 2013 Moot Inc

*/!function(e,t){"use strict";function n(e,n){var o={},i=[].slice;return e=e||{},t.extend(e,{on:function(n,i,a){if(n=n.split(" "),t.isFunction(i)&&(a=i,i=0),t.isFunction(a)){for(var r,l=0,s=n.length;s>l;l++)r=t.trim(n[l]),(o[r]=o[r]||[]).push(a),(s>1||"*"==n)&&(a.typed=!0);i&&(a.typed?a("inline",i):a(i))}return e},off:function(n,i){if("*"==n)return o={};n=n.split(" ");for(var a,r=0;n.length>r;r++)if(a=t.trim(n[r]),i){for(var l=o[a]||[],s=-1,c=0,u=l.length;u>c;c++)if(l[c]===i||l[c].listener===i){s=c;break}s>=0&&l.splice(s,1)}else o[a]=[];return e},one:function(n,o){function i(){e.off(n,o),o.apply(e,arguments)}return t.isFunction(o)&&(i.listener=o,e.on(n,i)),e},emit:function(t){var n=i.call(arguments,1),a=o[t]||[],r=o["*"];r&&(a=a.concat(r));for(var l,s,c=0,u=a.length;u>c;++c)if(l=a[c]){s=l.typed?[t].concat(n):n;try{if(l.apply(e,s)===!1)return e}catch(d){throw d}}return e}}),t.each(n||[],function(n,o){e[o]=function(n){return t.isFunction(n)?e.on(o,n):e.emit.apply(e,[o].concat([].slice.call(arguments)))}}),e}function o(o){function i(e,n,o){var i=new FormData;e.params[0],e.transport="ajax",t.each(n,function(e,t){i.append(t.altname||t.name,t)}),i.append("jsonrpc",JSON.stringify(e));var r=new XMLHttpRequest;r.onload=function(e){a(JSON.parse(e.target.response))},r.onprogress=function(e){o.progress(e)},r.open("POST",m),r.send(i)}function a(e){if(!e)return s.emit("heartbeat");if("string"==typeof e&&(e=JSON.parse(e)),e.params&&"ping"==e.params[0])return s.emit("heartbeat");if(t.isArray(e))return t.each(e,function(e,t){a(t)});s.emit("receive",e),e.session&&(c=e.session,t.cookie2(_,c.sessionId)),o.pollUrl=o.pollUrl||e.pollUrl;var n=p[e.id];n?(n.always(e.result,e.error),void 0!==e.result&&n.done(e.result)):"emit"==e.method&&u.emit.apply(null,e.params),void 0!==e.error&&(n&&n.fail(e.error,e.data),s.error(e.error,e.data)),l||(e.result&&s.ready(e.result),l=!0)}if(t.isFunction(o))return x.push(o);var r,l,s=n(this,["ready","error","close","reconnect","destroy"]),c={sessionId:t.cookie2(_)},u=n({}),d=0,p={};"string"==typeof o&&(o={url:o}),s.conf=o=t.extend({transports:"upgrade,xdomain",pollUrl:null,secure:!0},o);var m=o.url;if(443==m.port&&(m.port=80),m="http"+(o.secure?"s":"")+"://"+m.hostname+(m.port&&80!=m.port?":"+m.port:""),t.each(o.transports.split(","),function(e,t){var n=k[t];!r&&n&&n.supported&&(r=new n(m,s,a),s.transport=t)}),!r)throw Error("json-rpc: no support for "+o.transports);s.event=function(e,t){return u.on(e,t),s},s.session=function(){return t.extend({},c)},s.reload=function(){return d=0,r.destroy(),r.ping(),s},s.poll=function(){var e=o.pollUrl;-1==e.indexOf("://")&&(e=m+e),r.poll&&r.poll(e,t.extend({},c,{transport:r.name}))},s.log=function(e,n){var o={message:e,data:t.extend(n,{url:location.href,ua:navigator.userAgent})};t.post(m,JSON.stringify({method:"log",jsonrpc:"2.1.0",params:[o],session:c}),t.noop,"json")},window.mootlog=s.log,s.call=function(o){if(s.is_closed||s.is_destroyed)throw Error("connection "+(s.is_closed?"closed":"destroyed"));var a,u=[].slice.call(arguments),m=u.slice(-1)[0],f={method:o,params:u.slice(1,-1)};if(t.isFunction(m)?(a=n({},["done","fail","always","progress"]).done(m),f.id="#"+ ++d,p[f.id]=a):(void 0!==m&&(f.params=u.slice(1)),m=void 0),f.params.length||delete f.params,f.session=c,l||(f.jsonrpc="2.1.0"),f.transport=s.transport,s.emit("send",o,f.params,a),!e&&window.File&&f.params){var h=f.params[0],g=h&&h.files;if(g)return delete h.files,i(f,g,a),a}return r.send(JSON.stringify(f)),a},t.each(x,function(){this.call(s,r)});var f=e;e||t(window).load(function(){f=!0}),s.destroy(function(){s.is_destroyed=!0,r.destroy()}).error(function(e){"error_invalid_channel"==e&&(t.cookie2(_,""),s.inited=!1,s.reconnect())}).close(function(){l=!1}).ready(function(){t.isFunction(r.poll)&&(e?s.poll():setTimeout(s.poll,f?1e3:3e3))})}function i(e,t,n){e/=n?S:2,e+=~~(e/t);for(var o=A-$,i=~~(o*q/2),a=0;e>i;a+=A)e=~~(e/o);var r=(A-$+1)*e,l=e+D;return a+~~(r/l)}function a(e,t){for(var n=1114112,o=0,i=e.length;i>o;++o){var a=e[o];a>=t&&n>a&&(n=a)}return n}function r(e){return e+(26>e?97:22)}function l(e,t){return t+$>=e?$:e>=t+q?q:e-t}function s(e,t){for(var n=[],o=A,i=t;;o+=A){var a=l(o,e);if(a>i){n.push(r(i));break}n.push(r(a+(i-a)%(A-a))),i=~~((i-a)/(A-a))}return n}function c(e){e=e.split("").map(function(e){return e.charCodeAt(0)});for(var t=[],n=[],o=0,r=e.length;r>o;++o){var l=e[o];128>l?t.push(l):n.push(l)}var c,u;c=u=t.length,c&&t.push(45);for(var d=O,p=U,m=0,r=e.length;r>u;++d,++m){var f=a(n,d);m+=(f-d)*(u+1),d=f;for(var o=0;r>o;++o){var l=e[o];d>l?++m:l==d&&(t=t.concat(s(p,m)),p=i(m,u+1,c==u),m=0,u++)}}return String.fromCharCode.apply(String,t)}function u(e,n){return t.isFunction(e)&&e.apply(n,[].slice.call(arguments,2)),n}function d(e,t){e=e.replace("/moot.it/","/api.moot.it/").replace("/i/","/");var n=e.split("/");n[n.length-1]=n.slice(-1)[0].replace(":","#"),e=n.join("/");var o=e.split("#");o[1]&&(e=o[0]+"#"+p(o[1])),e=I(e),"/"==e.href.slice(-1)&&(e.href=e.href.slice(0,-1),e.pathname=e.pathname.slice(0,-1));var i=e.href,a=i.split("/"),r="//"==i.slice(0,2)||i.indexOf("://")>0?i.slice(8).indexOf("/")+8:i.indexOf("/");return e.path=i.slice(r),e.host=a[2],t&&!/moot.it/.test(e.host)&&(t=I(t),e.orighost=e.host,e.host=t.hostname+(t.port?":"+t.port:""),e.protocol=t.protocol,e.hostname=t.hostname,e.port=t.port),e}function p(e){e=t.trim(e.toLowerCase().slice(0,10*E)),e=e.replace(/&quest;/g,"");var n={a:/[áàâãªäå]/g,o:/[òóôõºöø]/g,e:/[éèê]/g,i:/[íìîı]/g,u:/[úùûü]/g,c:/[ç]/g,n:/[ñ]/g,"-":/[_\s]+/g};return t.each(n,function(t,n){e=e.replace(n,t)}),e=c(e).slice(0,10*E),e=e.replace(/[^a-z0-9-]/g,"").replace(/^-|-$/g,"").replace(/\-{2,}/g,"-"),e||(""+Math.random()).slice(10)}function m(e,n){if(void 0===e||"number"==typeof e)return L[1*e||0];if(t.isFunction(e)&&(n=e,e="ready"),"string"==typeof e)if(-1!=e.indexOf("/"))e={url:e};else if(t.isFunction(n))return(F[e]=F[e]||[]).push(n);if(t.isPlainObject(e)){e=t.extend({api:"https://api.moot.it"},e),"object"!=typeof console&&(e.debug=0);var o=new f(e);return t.isFunction(n)&&F.ready.unshift(n),t.each(F,function(e,n){t.each(n,function(){o.on(e,this)})}),o.emit("before:init",o),L.push(o),o}}function f(e){"string"==typeof e&&(e={url:e});var i,a=n(this),r=d(e.url,e.api),l=r.pathname.split("/");e.url=r,e.api=r.protocol+"//"+r.host,t.extend(a,{version:"1.7.6",channel:null,name:l[1],path:"/"+l[1],is_commenting:!!r.hash,is_forum:!r.hash&&3>l.length,is_threaded:!r.hash&&l.length>2,conf:function(){return e},load:function(t,n){if(a.is_stub)throw Error("Forum not created");a.is_threaded&&!t.split("#")[1]&&(t=e.url.path);var o=new w(a,t,i);a.emit("before:load",o),i.call("moots",{path:o.path},function(e){o.emit("load",e),a.one("load",n).emit("load",o)})},search:function(e,t){return a.load("/?"+e,t)},create:function(n,o){var r=m.fixTitle(n.title);if(!r)throw Error("Empty title");if(r.length>30*E)throw Error("Title too long");if(!a.user.is_logged)throw Error("Not logged");t.extend(n,{title:r,key:p(r),body:m.fixBody(n.body,!0),pageLocation:e.pageUrl,path:n.path||a.page.path,watch:!0}),a.is_threaded&&t.extend(n,{pageTitle:e.pageTitle,mootTitle:e.mootTitle});var l=new v(a,n.path+"#"+n.key,n,i,!0);return a.page.emit("before:moot",l),i.call("createMoot",n,function(e){l.emit("key",e),l.seed.emit("key",e),a.page.one("moot",o).emit("moot",l,!0),l.is_followed=!0,l.emit("follow")})},createForum:function(e,n){var o=e.categories;return"string"==typeof o[0]&&(o=t.grep(o,function(e){return!!e}),e.categories=o=t.map(o,function(e){return{title:e.slice(0,40),path:a.path+"/"+p(e)}})),i.call("createForum",e,function(){a.is_stub=!1,a.categories=o,a.emit("categories",o),u(n,a,o)})},getCategory:function(e){return e=e.split("#")[0],t.grep(a.categories,function(t){return t.path==e})[0]},setCategories:function(e,n){return t.each(e,function(e,t){t.path||(t.path=p(t.title)),-1==t.path.indexOf(a.path)&&(t.path=a.path+"/"+t.path)}),i.call("setCategories",{path:a.path,categories:e},function(){a.emit("categories",e),u(n,a,e)})},update:function(e,t){a.user.is_admin&&(e.forumname=a.name,i.call("forumUpdate",e,function(){a.one("update",t).emit("update",e)}))},reload:function(e){return a.channel.off("*"),a.off("before:load load error waiting destroy categories"),a.page=new w(a,a.page.path,i),t.isFunction(e)&&(a.one("load",e),e=null),e&&(e.moots||e.user)?a.emit("init",e):a.emit("before:init",a),a},log:function(e,n){n=t.extend({forum:a.path,page:a.page.path,user:a.user.email,version:a.version,url:location.href,ua:navigator.userAgent},n),i.call("log",{message:e,data:n})},destroy:function(){return i.destroy(),a.is_destroyed=!0,a.emit("destroy")}}).on("before:init",function(){i||(i=new o({url:r,transports:e.transports,secure:!(t.browser.msie&&"https"!=e.pageUrl.slice(0,5))}),a.channel=new h(a,i),i.reconnect(a.reload),a.page=new w(a,r.path,i),e.path&&(a.is_forum||a.is_threaded&&e.path.split("#")[1])&&(a.page=new w(a,e.path,i))),a.page.is_init=!0,e.pageUrl.split("file://")[1]&&(e.pageUrl="https://moot.it"+a.path);var n={version:a.version,path:a.page.path,currentForum:a.name,pageLocation:e.pageUrl};e.sso&&e.sso.key&&(n.api=e.sso),i.call("init",n,function(e){a.emit("init",e)}).fail(function(e){a.emit("error",e[0])})}).on("init",function(e){a.page.is_init=!0,t.extend(a,e),a.is_stub=!e.moots,a.user=new b(a,e.user,i),a.emit("ready",a,i),a.emit("before:load",a.page),a.page.emit("load",e.moots),a.emit("load",a.page),delete a.moots}).on("load",function(e){a.page=e}).on("categories",function(e){e&&(a.categories=e,a.is_stub=!1)})}function h(e,o){var i=n(this),a=e.conf().debug;o.event("moot",function(t,n){t.from_channel=n.from_channel=!0;var a=new v(e,t,n,o),r=!!e.getCategory(t.path),l=e.page;e.is_forum&&r&&i.emit("moot",a),"feed"!=l.type&&("all"!=l.type&&(a.page.path+"/").slice(0,l.path.length+1)==l.path+"/"||l.title==a.seed.user.displayname||"all"==l.type&&r)&&(e.is_forum||i.emit("moot",a),l.emit("moot",a,!0))}).event("reply",function(t,n){var a=e.page.find(t);if(!a){if(e.is_commenting)return!1;if(e.is_threaded){if(t.split("#")[0]!=e.page.path)return!1}else if(!e.getCategory(t))return!1;a=new v(e,t,{},o)}n.from_channel=!0,n=new y(a,n,o),a.emit("reply",n),i.emit("reply",n)}).event("type",function(t,n){(e.is_forum&&e.getCategory(t)||e.page.path==t)&&i.emit("type",n,t);var o=e.page.find(t);o&&o.emit("type",n)}).event("like unlike remove spam unspam update",function(t,n,o){var a=e.page.find(n);a&&a.seed&&(a=a.seed),a&&a.emit(t,o,!0),i.emit(t,a||n,o)}).event("error",function(e,t){a&&console.error(arguments),i.emit("error",e,t)}).event("enter leave away return login join",function(e,t,n){i.emit(e,t,n)}).event("banned message",function(t,n){e.user.emit(t,n)}).on("send",function(n,o,i){if(i){var a,r=+new Date;t.each([3e3,5e3,8e3,12e3],function(t,o){setTimeout(function(){!a&&+new Date-r>o&&(0==t&&e.emit("waiting",n,i),i.emit("progress",t,o))},o)}),i.done(function(){a=1}).fail(function(){a=1})}}).ready(function(){i.session=o.session()}).on("login close reconnect error",i.emit),a&&o.on("send",function(e,t){console.info(">",e,t&&1==t.length?t[0]:t)}).on("receive",function(e){e&&console.info("<",e.result||e.params||e)})}function g(e,n,o,i){var a=this,r=e.path,l=e.app.page,s=e.match_count>=0&&i;a.is_gap=!0,a.size=a.available=n,s&&(a.match_count=e.match_count,t.each(e.replies,function(){this.is_gap||a.match_count--})),a.more=function(i,s){if(!a.available)return u(s);var c=Math.min(a.available,Math.ceil(n/(10>n?1:27>n?2:4))),d=i?c:e.reply_count,p=i?1:c,m=i?0:e.replies.length-1;if(i)for(var f,h=0;e.replies.length>h&&(f=e.replies[h],f!=a);h++)d+=f.is_gap?f.available:1,p+=f.is_gap?f.available:1,m++;else{for(var f,h=m;h>=0&&(f=e.replies[h],f!=a);h--)d-=f.is_gap?f.available:1,m--;0>=m&&(m=1),p=d-p+1}var v={path:r,start:d,end:p,timeout:300};return a.match_count>0&&(v.path+="search"==l.type?"?"+l.title:"@"+l.username,delete v.end),o.call("moreReplies",v,function(n){n=t.map(n,function(t){var n=t.reply_count;return a.available-=n||1,!n&&a.match_count&&a.match_count--,n?new g(e,n,o):new y(e,t,o)}),0>a.available&&(a.available=0),e.one("more",s).emit("more",n,m)})}}function v(e,o,i,a,r){function l(){if(r)throw Error("Not saved");if(!e.user.is_logged)throw Error("not logged")}var s=n(this),c=e.page;if("string"==typeof o){var d=o.split("#");o={page:e.getCategory(d[0])||{path:o,title:o},path:o}}r&&(o.is_expanded=!0),t.extend(s,o),t.extend(s,{app:e,replies:[],reply_count:s.reply_count||0,time:s.time||+new Date,has_replied:!!o.has_replied,is_followed:!!o.is_watched,is_expanded:!!o.is_expanded}),s.page=s.page||{},s.page.path=o.path.split("#")[0],r||i.user||e.is_commenting||(s.is_commenting=!0,i.user={}),s.seed=i=new y(s,i,a,r),s.is_own=r||i.user&&i.user.path==e.user.path,t.extend(s,{is_loaded:s.is_expanded,reply:function(n,o){if(l(),!t.trim(n.body))throw Error("no content");var i=e.conf(),r=s.seed.is_stub;n.body=m.fixBody(n.body,!0),n.key=p(n.body.join("")),n.watch=!0;var u=new y(s,n,a,!0);return s.emit("before:reply",u),t.extend(n,{path:r?c.path:s.path,mootTitle:i.mootTitle||i.pageTitle,pageTitle:i.pageTitle,pageLocation:i.pageUrl}),a.call("reply",n,function(e){u.emit("key",e),s.one("reply",o).emit("reply",u),s.is_followed=!0,s.emit("follow")})},posts:function(){return t.grep([s.seed].concat(s.replies||[]),function(e){return!e.is_gap})},find:function(e){if(s.seed.key==e)return s.seed;e.split("#")[1]||(e=s.path+"/"+e);for(var t=0,n=s.posts(),o=n.length;o>t;t++)if(n[t].path==e)return n[t]},expand:function(e){return s.toggle(!0,e)},collapse:function(e){return s.toggle(!1,e)},load:function(t){var n=s.path+("search"==e.page.type?"?"+e.page.title:"user"==e.page.type?"@"+e.page.username:"");return s.is_loaded?u(t,s):a.call("moot",n,function(e){s.one("load",t).emit("load",e).emit("expand")})},toggle:function(n,o){function i(){return s.one(r,o).emit(r)}if(t.isFunction(n)&&(o=n,n=void 0),"boolean"!=typeof n&&(n=!s.is_expanded),n==s.is_expanded)return u(o,s);if(n&&!s.is_loaded)return s.load(o);var r=n?"expand":"collapse";return e.user.is_logged?a.call(r+"Moot",s.path,i):i()},followToggle:function(n,o){if(l(),t.isFunction(n)&&(o=n,n=void 0),"boolean"!=typeof n&&(n=!s.is_followed),n==s.is_followed)return u(o,s,n);var i=s.path;return n&&(i={pageLocation:e.conf().pageUrl,path:i}),a.call("moot"+(n?"Watch":"Unwatch"),i,function(){var e=n?"follow":"unfollow";s.is_followed=n,s.one(e,o).emit(e)})}}).on("key",function(e){r=!1,s.path=s.page.path+"#"+e}).on("load",function(e){s.is_loaded=s.is_expanded=!0,s.reply_count=e.reply_count,s.seed=new y(s,e.seed,a)}).on("load",o,function(e){var n=0;s.match_count=e.match_count,t.each(e.replies||[],function(e,t){var o=t.reply_count;s.replies.push(o?new g(s,o,a):new y(s,t,a)),n+=o||1}),s.is_expanded&&s.reply_count>n&&s.replies.unshift(new g(s,s.reply_count-n,a,!0))}).on("reply",function(e){s.lastReply=+new Date,s.reply_count++,e.is_own&&(s.has_replied=!0),s.is_loaded&&s.replies.push(e)}).on("remove",function(e){return e.is_seed?c.emit("remove",s):(s.replies=t.grep(s.replies,function(t){return t.path!=e.path}),s.reply_count--,void 0)}).on("more",function(e,t){[].splice.apply(s.replies,[t,0].concat(e))}).on("expand collapse",function(e){s.is_expanded="e"==e[0]})}function w(e,o,i){var a=n(this);e.path&&o.slice(0,e.path.length)!=e.path&&(o=e.path+"/"+o),o=o.replace("//","/").replace(/[<>]/g,""),"/"==o.slice(-1)&&(o=o.slice(0,-1));var r=o.split("::");o=r[0],a.type=/\?/.test(o)?"search":/feed/.test(o)?"feed":o==e.path+"/spam"?"spam":/@/.test(o)?"user":2==o.split("/").length?"all":/#/.test(o)?"moot":"page","user"==a.type&&(a.username=o.split("@")[1]),t.extend(a,{app:e,path:o,extra:r[1],find:function(e){for(var t,n=0;a.length>n;n++){if(t=a[n],t.path==e)return t;if(t=t.find(e))return t}},more:function(e){return a.available?(a.emit("before:more"),i.call("moots",{path:a.path,start:a.length},function(t){a.one("more",e).emit("more",t)})):void 0},lift:function(t,n){var o=a.find(t);o&&e.page.emit("remove",o),i.call("moot",t,function(t){var o=new v(e,t,t.seed,i);a.one("moot",n).emit("moot",o,!0)})},reply:function(e,n){var i=a.find(e.path);return i?i.is_expanded?i.reply(e,n):i.expand(function(){i.reply(e,n)}):a.lift(o,function(o){setTimeout(function(){o.reply(e,n)},t.browser.msie?1e3:0)}),i},like:function(e){var t=a.find(e);return t?(t.seed&&(t=t.seed),t.like()):i.call("like",e),t},collapse:function(e){var n=t.grep(a,function(e){return e.is_expanded}),o=t.map(n,function(e){return e.path});return i.call("collapseMoot",o,function(){t.each(n,function(){this.emit("collapse",!0)}),u(e,a,n)})}}).on("load",function(n){return e.is_stub?!1:(t.extend(a,n),a.available=n.size,delete a.entries,e.is_commenting&&(n.entries[0]||n.entries.push({seed:{user:e.user},is_expanded:!0,path:o}),n.entries[0].seed.is_stub=!0),void 0)}).on("load more",function(n,o){t.each(o.entries,function(t,n){var o=new v(e,n,n.seed,i);a.emit("moot",o)}),a.available-=o.entries.length}).on("moot",function(e,t){a[t?"unshift":"push"](e)}).on("remove",function(e){var n;t.each(a,function(t,o){return o.path!=e.path?(n=t,!1):void 0}),n&&(a.splice(n,1),a.size--)})}function y(e,o,i,a){function r(){if(!c.is_logged)throw Error("not logged");if(a)throw Error("not saved")}var l=n(this),s=e.app,c=s.user,d=e.path+(o.title||o.is_stub?"":"/"+o.key);a&&(o=t.extend({},o,{user:c})),o.body=o.body||[],o.user=o.user||{},s.users&&s.users.isAdmin(o.user)&&(o.user.is_admin=!0),t.extend(l,o,{app:s,moot:e,path:d,key:o.key||d.split("#")[1],is_own:a||o.user.path==c.path,likes:0,is_expanded:!!o.body[1],is_loaded:!o.has_more||!!o.body[1],is_seed:!!o.title,is_new:!!o.from_channel||c.new_count.all>0&&o.is_new,is_liked:!!o.is_liked,like_count:o.like_count||0,meta:o.meta||{},time:o.time||+new Date,likeToggle:function(n,o){if(r(),t.isFunction(n)&&(o=n,n=void 0),void 0===n&&(n=!l.is_liked),n==l.is_liked)return u(o,l,c);var a=l.is_liked?"unlike":"like",p=s.conf(),m=d;return e.seed.is_stub&&n&&(m={pageLocation:p.pageUrl,mootTitle:p.mootTitle||p.pageTitle,pageTitle:p.pageTitle,path:d}),i.call(a,m,function(){l.one(a,o).emit(a,c),e.emit(a,l)})},like:function(e){return l.likeToggle(!0,e)},unlike:function(e){return l.likeToggle(!1,e)},setMeta:function(e,t){return r()&&i.call("setMeta",d,e,function(){l.one("meta",t).emit("meta",e)})},remove:function(e){if(!l.removable())throw Error("No permission");var t=c.is_admin?{path:d,force:1}:d;return i.call("delete",t,function(){l.one("remove",e).emit("remove")})},removable:function(){return c.is_admin||a||l.is_own&&!l.like_count&&(!e.replies.length||e.replies.slice(-1)[0]==l)&&2.718*60>(+new Date-l.time)/1e3},whoLikes:function(e){return l.likes?e.call(l,l.likes):i.call("whoLikes",d,function(t){l.likes=t||[],u(e,l,t)})},more:function(e){return l.is_loaded?u(e,l):i.call("more",d,function(t){l.one("more",e).emit("more",t)})},toggle:function(e,n){function o(){return l.one(a,n).emit(a)}if(t.isFunction(e)&&(n=e,e=void 0),void 0===e&&(e=!l.is_expanded),e===l.is_expanded)return u(n,l);if(e&&!l.is_loaded)return l.more(n);var a=e?"expand":"collapse";return c.is_logged?i.call(a+"Post",d,o):o()},expand:function(e){return l.toggle(!0,e)},collapse:function(e){return l.toggle(!1,e)}}).on("key",function(t){l.key=t,l.path=d=l.is_seed?e.path:e.path+"/"+t,a=!1}).on("like",function(e){(e.is_logged||e.path==c.path)&&(l.is_liked=!0),l.likes&&l.likes.push(e),l.like_count++}).on("unlike",function(e){(e.is_logged||e.path==c.path)&&(l.is_liked=!1),l.likes&&(l.likes=t.grep(l.likes,function(e){return e.path!=c.path})),l.like_count--}).on("more",function(e){l.is_loaded=l.is_expanded=!0,l.body.push(e)}).on("expand collapse",function(e){l.is_expanded="expand"==e}).on("remove",function(t,n){e.emit("remove",l,n)}).on("meta",function(e){t.extend(l.meta,e)}).on("update",function(e){t.extend(l,e)}).on("spam unspam",l.spam_level,function(e,t){if(l.spam_level=t,"inline"!=e&&(l.flag=e),-1==t)l.emit("remove");else if(t>=1){var n=20*E;l.body[0]=l.body[0].replace(/\n/g," "),l.body[0].length>n&&(l.body[1]=l.body[0].slice(n)+(l.body[1]||""),l.body[0]=l.body[0].slice(0,n)),l.is_expanded=!1}}),t.each(["spam","unspam"],function(e,t){l[t]=function(e){return r(),i.call(t,d,function(n){l.one(t,e).emit(t,n)})}})}function b(e,o,i){function a(){if(!l.is_logged)throw Error("must be logged")}function r(e){return e[0].toUpperCase()+e.slice(1)}var l=n(this),s=(e.path+"/feed",0);o.new_count=o.new_count||{all:0,feed:0},e.is_stub&&o.path&&(o.is_admin=!0),o.img=o.img||"//cloudinary-a.akamaihd.net/moot/image/upload/t_default-avatar/v1364433583/moot-default-avatar.jpg",o.email||delete o.email,t.extend(l,o,{app:e,is_logged:!!o.path,is_visible:!!o.is_visible,logout:function(t){return a(),i.call("logout",e.page.path,function(n){e.reload(n),u(t,l)})},join:function(t,n){if(l.is_logged)throw Error("already logged");return t.username=t.username.toLowerCase(),i.call("join",t,function(t){e.reload(t),u(n,l)})},update:function(t,n){return t.forumname=e.name,i.call("userUpdate",t,function(){t.url||l.emit("update",t),u(n,l)})},isAvailable:function(e,t){return i.call("isAvailable",e,t)},unfollowAll:function(){return i.call("forumUnwatch",e.path,function(){t.each(e.page,function(){this.is_followed=!1,this.emit("unfollow")})})},type:function(t,n,o){if(!l.is_logged||l.is_visible){var a=+new Date;a-s>1e3*E&&(i.call("type",{path:n?n.path:e.page.path,size:t.length},o),s=a)}},hideToggle:function(t){return i.call("user"+(l.is_visible?"Hide":"Show"),function(){var n=l.is_visible=!l.is_visible;e.channel.emit(n?"enter":"leave",l,e.users.anon_count),u(t,l,n)})}}),t.each(["email_confirm","account_confirm","password_reset","validationCode_send","resetCode_check"],function(t,n){var o=n.split("_");l[o[1]+r(o[0])]=function(t,n){return i.call(o[0]+r(o[1]),t,function(t){t&&t.moots&&e.reload(t),u(n,l,t)})}}),l.on("update",function(e){delete e.email,t.extend(l,e),l.is_logged=!0}).on("follow unfollow",function(e){l.subscription_count+="follow"==e?1:-1}),e.on("load",function(e){l.emit("newcount",l.new_count),l.new_count[e.type]=0,"all"==e.type&&(l.new_count.feed=0)}),e.channel.on("moot reply",function(t,n){e.page.find(n.path)||(l.new_count.all++,l.emit("newcount",l.new_count))})}!function(e){if(!e.browser){var t=e.browser={},n=navigator.userAgent.toLowerCase(),o=/(chrome)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||0>n.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[];o[1]&&(t[o[1]]=!0,t.version=o[2]||"0")}}(jQuery);var _="jsonrpc.session",k={},x=[];e||(window.RPC=o),k.ajax=function(e,n,o){var i=this,a={};t.extend(i,{send:function(n){n=n.replace(/\?\?/g,"?&quest;"),t.post(e,n,o,"json")},poll:function(e,r){i.destroy(),a=t.post(e,r,0,"json").done(function(t){o(t),t.error||i.poll(e,r)}).fail(function(e,t){n.is_destroyed||"abort"==t||n.close()})},destroy:function(){1==a.readyState&&a.abort()},ping:function(n){return t.ajax({url:e+"/ping",dataType:"text"}).done(n)}})},k.ajax.supported=t.support.cors,t.cookie2=function(e,t,n){var o=window.localStorage,i=null===t,a=void 0===t;if(void 0===n&&(n=999),"file:"==location.protocol){if(o)return i?o.removeItem(e):a?o[e]:o[e]=t;throw"moot: localStorage support needed under file:// protocol"}if(i&&(n=-1),a){var r,l,s=document.cookie;if(s&&(r=s.indexOf(e+"="),r>-1))return l=s.indexOf(";",r),s.slice(r+e.length+1,l>-1?l:s.length)}else document.cookie=e+"="+escape(t)+"; path=/"+(n?";expires="+new Date(+new Date+864e5*n).toUTCString():"")},k.upgrade=function(e,n,o){var i,a=this,r=new k.ajax(e,n,o),l=k.websocket.supported;l&&(l=new k.websocket(e,n,o),n.one("receive",function(e){e.result&&l.ping(function(){if(!e.session||!e.session.sessionId)throw Error("Empty sessionId");l.send(JSON.stringify({method:"rpc.upgrade",session:e.session})),i=!0,r.destroy(),n.emit("upgrade",l)})})),t.each(["send","close","poll","ping","destroy"],function(e,t){a[t]=function(){var e=(i?l:r)[t];return e?e.apply(null,arguments):a}})},k.upgrade.supported=t.support.cors||e;var T=e?require("ws"):window.WebSocket||window.MozWebSocket;if(k.websocket=function(e,n,o){var i,a=e.replace(/^http/,"ws"),r=this,l={};t.extend(r,{send:function(s,c){var u=l.readyState;if(0!==u){if(1==u)return s&&(l.send(s),i=s),c&&c();l=new T(a),window.mootsocket=l,l.onopen=function(){u=l.readyState,l.onmessage=function(e){o(e.data),i=null},l.onclose=function(e){l={},!e.wasClean&&i?r.send(JSON.stringify({method:"rpc.upgrade",session:n.session()}),function(){r.send(i)}):n.is_destroyed||n.close()},l.onerror=function(i){u=l.readyState,3!=u&&s&&(n.log("socket error",{err:i,msg:s,state:u}),t.post(e,s,o,"json").done(function(e){n.log("socket fix",{ret:e,msg:s})}))},s&&l.send(s),c&&c()}}},destroy:function(){1==l.readyState&&l.close()},ping:function(e){return r.send(null,e),{fail:t.noop,abort:t.noop}}})},k.websocket.supported=!!T,!e&&T){var j=navigator.userAgent.toLowerCase(),C=navigator.appVersion.split("Version/")[1];T&&t.browser.webkit&&!/chrome/.test(j)&&C&&"5.1.14">C.split(" ")[0]&&(k.websocket.supported=!1),t.browser.mozilla&&t(document).keydown(function(e){27==e.which&&e.preventDefault()})}k.xdomain=function(e,n,o){function i(e,n,o,i){var a=s[e];return a||(a=s[e]=new XDomainRequest,a.onerror=t.noop,a.ontimeout=t.noop,a.onprogress=t.noop),a.open(i||"post",e),a.onload=function(){var e=a.responseText;try{e=JSON.parse(e)}catch(t){}o(e)},a.send(n),a}var a,r=this,l={},s={};r.send=function(t){i(e,t,o)},r.destroy=function(){a&&(a=!1,l.abort())},r.poll=function(e,s){n.is_destroyed||(r.destroy(),a=!0,l=i(e,t.param(s),function(t){a=!1,o(t),setTimeout(function(){t.error||r.poll(e,s)},200)}),l.onerror=function(){console.error("xdomain",JSON.stringify(arguments[0])),n.is_destroyed||n.close()})},r.ping=function(t){var n=i(e+"/ping?"+Math.random(),"",t,"get");return{fail:function(e){n.onerror=e},abort:function(){n.abort()}}}},k.xdomain.supported=window.XDomainRequest,o(function(e){var t,n,o=3e4,i=this;i.conf,i.on("receive heartbeat",function(){t=+new Date}).on("close reconnect",function(e){i.is_closed="close"==e}).ready(function(){if("file:"!=location.protocol&&"localhost"!=location.hostname||navigator.onLine){var a;n=n||setInterval(function(){navigator.onLine!==!1||i.is_closed?i.is_closed===!0&&navigator.onLine!==!1?(a&&a.abort(),a=e.ping(i.reconnect)):i.is_closed||(t=t||+new Date,+new Date-t>o&&e.ping(function(){t=+new Date,i.poll()}).fail(i.close)):i.close()},1e3)}}).destroy(function(){clearInterval(n)})}),t.fn.jsonrpc=function(e){var n=0;return this.each(function(){var o=t(this),i="#multipart-rpc-"+n++,a=t(":input[name]",o),r=(t("<iframe/>",{name:i,src:"about:blank"}).hide().insertBefore(o),t("<input/>",{type:"hidden",name:"jsonrpc"}).appendTo(o)),l=t(window);o.attr({action:e.api,method:"post",target:i,enctype:"multipart/form-data"}),o.submit(function(){var n=e.params||{};a.filter(e.query||"*").each(function(){this.disabled||(n[this.name]=t(this).val())}),a.prop("disabled",!0).filter(":file").each(function(){this.disabled=!this.value}),r.val(JSON.stringify({session:e.session,method:e.method,params:[n],jsonrpc:"2.1.0",transport:"iframe",id:i})),l.on("message."+i,function(e){try{var t=JSON.parse(e.originalEvent.data),n=t.result||t.error;t.id==i&&(a.prop("disabled",!1),o.trigger(t.result?"done":"fail",n).trigger("always",n),l.off("message."+i))}catch(e){}})})})};var $=1,q=26,A=36,D=38,S=700,O=128,U=72,E=2.718,I=e?require("url").parse:function(e){var t=document.createElement("a");t.href=e;var n=t.pathname;return"/"!=n[0]&&(n="/"+n),{href:e,pathname:n,port:1*t.port||"",hostname:t.hostname,hash:t.hash,search:t.search,protocol:t.protocol}};m.urlify=p;var L=[],F={};e?module.exports=m:window.moot=m,w.prototype=[],m(function(e){function n(e){for(var t=0;o.length>t;t++)if(o[t].path==e)return t;return-1}if(e.users){var o=e.users.online,i=e.admins||[];e.users.find=function(e){return o[n(e)]},e.users.isAdmin=function(e){if(e)for(var t=0;i.length>t;t++)if("@"+i[t].username==e.path)return!0},t.each(o,function(){e.users.isAdmin(this)&&(this.is_admin=!0)}),e.channel.on("enter",function(t){t&&(t.is_admin=e.users.isAdmin(t),o.push(t))}).on("leave",function(e){if(e){var t=n(e.path);t>=0&&o.splice(t,1)}}).on("away return",function(t,n){n&&(n=e.users.find(n.path)),n&&(n.is_active="return"==t)}).on("enter leave away return",function(t,n,o){e.users.anon_count=o})}});var W=400*E,z=40*E,H=30*E,M=20,R=/\[#(.+)\/#\]/g,P=/-{3,} *(\w*)/g;m.fixTitle=function(e){return e=t.trim(e).replace(R,"$1"),t.each(e.split(/\s+/g),function(t,n){n.length>H&&!/https?:\/\//.test(n)&&(e=e.replace(n,n.slice(0,H)+" "+n.slice(H,2*H)))}),e},m.fixBody=function(e,t){if(e=m.fixTitle(e).replace(/\n{2,}/g,"\n\n"),!t)return[e];var n=e.slice(0,W),o=e.slice(n.length);o.length&&z>o.length&&(n=e.slice(0,W-z));var i=M+n.split(P).length/2,a=e.split("\n");return a.length>i&&(n=a.slice(0,i).join("\n").slice(0,W)),o=e.slice(n.length),n=[n],o&&n.push(o),n}}(!this.top,jQuery),!function(e,t){"use strict";function n(e){return e&&e.replace(D,function(e,t,n){return"8)"==n&&"\n"==t?t+n:"<i>"+t+A[n]+"</i>"})}function o(e,t){return e&&(e=e.replace($,"&lt;$1$2$3"),t&&(e=e.replace(q,"<mark>$1</mark>"))),e}function i(e,t){return e?(e=e.replace(O,"&hellip;").replace(U,"&#8220;$1&#8221;").replace(E," &#8216;$1&#8217;").replace(W,"&mdash;").replace(z," &ndash; "),t?e:e.replace(L,"<samp>$1</samp>").replace(F,"<em>$1</em>").replace(I,function(e,t){return/\s/.test(t)?"<em>"+t+"</em>":"<strong>"+t+"</strong>"})):""}function a(e){return e.replace(/<(\w{1,2})"([\w\- ]+)"([^>]*)>/g,function(e,t,n,o){return n="m-"+n.split(" ").join(" m-"),"<"+(H[t]||t)+' class="'+n+'"'+o+">"}).replace(/<(\/?)(\w)>/g,function(e,t,n){return"<"+t+H[n]+">"})}function r(e){var t=new Date,n=moot.language,o=(t-e)/1e3,i=Math.floor(o/86400),a=Math.ceil(i/7),r=0>=i&&(60>o&&n.now||3600>o&&Math.floor(o/60)+n.min||86400>o&&Math.floor(o/3600)+n.hour)||7>i&&i+n.day||10>a&&a+n.week;if(r)return r;var l=new Date(e),s=l.getYear();return R=R||n.months.split(","),l.getDate()+" "+R[l.getMonth()]+(s!=t.getYear()?" "+(s+1900):"")}function s(e){return""+new Date(e)}function c(e,t){return(P[e]=P[e]||Function("_","return '"+e.replace(/\{([^\}]+)\}/g,"'+ (_.$1 === undefined ? '' : _.$1) +'")+"'"))(t)}function u(e,n){var o=t.extend({},n||{},{l:moot.language}),i=T[e];o.time&&(o.prettyTime=r(o.time),o.fullTime=s(o.time));try{return c(i,o)}catch(a){console.error(e,i,a,o)}}function d(e,n){if(e=e.replace(/<\/?mark>/g,"").replace(/<\/?em>/g,"_"),X.test(e.split("?")[0])){var o="m-image",i=e.split("?")[0].split("/").slice(-1)[0];return e.split("flickr.com")[1]?o+=" m-flickr-link":e.split("dropbox.com")[1]&&(e=e.replace("www.dropbox","dl.dropbox"),o+=" m-dropbox-link"),i.length>27&&(i=i.slice(0,10)+"&hellip;"+i.slice(-18)),"<a class='"+o+"' href='"+e+"'>"+(n||i)+"</a>"}var a=e,r="class='m-link";"http"!=e.slice(0,4)||e.split(location.host)[1]?(r+=" m-local-link",a=a.replace(RegExp("https?://"+location.host),"").replace(location.pathname,""),"#!/"==a.slice(0,3)&&(r+=" m-moot-link",e=a,a=a.slice(3)),r+="'"):(a=a.split("://")[1],t.each(Y,function(t,n){var t=e.indexOf(n);return-1!=t?("google.com"==n?(a=a.split("q="),a=a[1]?a[1].split("&")[0]:a[0]):(a=e.slice(t+n.length+1),/wikipedia/.test(n)?a=a.replace("_"," "):"d.pr"==n&&(r+=" m-image","+"!=e.slice(-1)?e+="+":a=a.slice(0,-1))),r+=" m-"+n.split(".")[0]+"-link'",!1):void 0}),r+="' target=_new "),a.length>40&&("/"==a.slice(-1)&&(a=a.slice(0,a.length-1)),a=a.split("/"),a=a[1]?a[0]+"/&hellip;/"+a.slice(-1)[0].slice(-27):a[0].slice(0,27)+"&hellip;");var l=e.slice(-1);return("."==l||","==l||")"==l&&-1==e.indexOf("("))&&(e=e.slice(0,-1)),"<a "+r+" href='"+e+"'>"+(n||a)+"</a>"}function p(e){return e.replace(N,function(e,t,n){return d(n,t)}).replace(J,function(e,t){if(t)return e;var n=e.split("&#82");return n[1]?d(n[0])+"&#82"+n[1]:d(e)})}function m(e,n,o){var i=window,a=(i.screenX||i.screenLeft)+(t(i).outerWidth()-n)/2,r=(i.screenY||i.screenTop)+50,l="left="+a+",top="+r+",resizable=0,location=0,status=0,scrollbars=0,dialog=0";i.open(e,"moot_popup",l+",width="+n+",height="+o)}function f(e){return e=parseInt(e,10),e>=10?e:"0"+e}function h(e){e=e||0;var t=(Math.floor(e/3600),Math.floor(e/60));return e-=60*t,t+":"+f(e)}function g(e,n,o){e&&e.length&&(t("html, body").animate({scrollTop:e.offset().top-(n||200)},400,o),e.mootboost())
}function v(e){var n=t(u("more")),o=n.eq(0),i=n.eq(2),a=n.eq(1),r=t("a",a).tooltip2({prefix:"m-",position:"right"}),l=t(".m-tooltip",r.eq(1)),s=t("em",r).text("+"+e.available);return e.available>26&&(a.ac("big"),l.text(moot.language.show_new)),r.click(function(){var n=t(this).ac("loading"),r=n.hc("to-head"),c=r?o:i,u={};u[r?"paddingBottom":"paddingTop"]=75*Math.min(e.available,10),c.animate(u),e.more(r,function(o){n.rc("loading"),s.text("+"+e.available),c.stop().css({padding:0}),r||o.reverse(),t.each(o,function(e,t){t=t.is_gap?v(t):y(t),t.is_gap||t.mootboost(),c[r?"append":"prepend"](t)}),10>e.available&&(a.rc("big"),l.text(moot.language.show_more)),e.available||a.remove()})}),n}function w(e,a){function l(e){return e.join("").replace(q,"$1")}function c(){var e;t(".m-seed, .m-reply:not(.m-preview)",h).each(function(){var n=t(this),o=t(".m-facelink img",this).attr("title");e&&o&&n.tc("followup",e===o),e=o})}function d(n){var o=t(".m-replies, .m-seed .m-body-wrap, .m-form",h);n?(h.ac("animating expanded").rc("collapsed"),o.mootslide(200,function(){h.rc("animating")})):o.slideUp(100,function(){h.rc("expanded").ac("collapsed"),t(this).css({display:""})}),e.is_expanded=n}var p=e.app,m=e.seed,f=window.moot.language,h=t(u("moot",t.extend({},e,m))),g=t(".m-replies",h),w="search"==a.type;h.data("moot",e),e.root=h.mousemoved("moot-hover").tc("flat",!!e.is_commenting),h.prepend(y(m,!0));var b=t(".m-seed",h);return e.is_expanded||h.ac("collapsed"),e.on("expand",!0,function(){var n=t(".m-follow",b).tooltip2({prefix:"m-"}).click(function(){return n.ac("loading"),e.followToggle(),!1})}).on("follow unfollow expand",!0,function(n){var o=e.is_followed;t(".m-follow",b).rc("loading hovered").tc("followed",o).find(".m-tooltip").text(f[o?"unwatch":"watch"]),p.user.emit(n)}),e.on("load",e.is_expanded,function(n){var o="load"==n||n.seed;if(h.ac("expanded").rc("loading collapsed"),o){var i=y(e.seed,!0);b.replaceWith(i),m.root=b=i}t.each(e.replies,function(e,t){g.append(t.is_gap?v(t):y(t))}),o&&(d(!0),c())}).on("collapse",function(e){e&&d(!1),t(".m-new_count",b).hide()}).on("remove",function(e,n){if(e.is_own&&!n){var o=e.is_seed?t(".m-create textarea",p.root):t("textarea",h);e.is_seed?(o.eq(0).val(l([e.title])).focus(),o.eq(1).val(l(e.body))):(o.val(l(e.body)).focus(),o[0].select())}}).on("before:reply",function(e){p.user.is_admin||t(".m-remove",h).remove(),y(e).appendTo(g),e.root.ac("created"),e.on("key",function(){setTimeout(function(){e.root.rc("created")},500)})}).on("reply",function(n){n.from_channel&&e.is_loaded&&(p.user.is_admin||t(".m-remove",h).remove(),y(n).appendTo(g).mootslide()),n.is_own&&t(".m-is-new",h).rc("is-new")}).on("type",function(n){var o=t("<em/>").ac("typing").appendTo(t(".m-actions:first",h)),i=t(".m-writing",h);e.is_expanded&&i.html(u("writing",{user:n})),setTimeout(function(){o.remove(),i.empty()},1e3*B)}).on("*",!0,function(l){if("type"!=l){var u=e.reply_count,d=(e.new_count,(e.is_expanded?m.time:e.lastReply)||m.time);t(".m-reply_count",b).toggle(u>0).text(u).tc("has_replied",!!e.has_replied),p.is_commenting&&(u&&t(".m-comment_count",h).text(u+" "+f["comm_count_"+(u>1?"n":"1")]),h.tc("first-comment",!u),m.like_count||m.is_liked||t(".m-like",m.root).text(f.likepost));var g=t(".m-time",b).text(r(d)).attr({title:s(d),"data-time":d}).tooltip2({prefix:"m-",timeout:500});t(".m-title",b).html(n(i(o(m.title,w),!0))),"moot"!=a.type&&t(".m-permlink",h).tooltip2({prefix:"m-"}).add(g).attr("href","#!"+e.path.replace(p.path,"")),e.page&&"page"!=a.type&&t(".m-cat",b).html(f.in_forum+" <a>"+e.page.title+"</a>").find("a").click(function(){return e.is_expanded?(p.load(e.page.path),!1):void 0}),c()}}),p.is_commenting||"moot"==a.type||h.click(function(n){if(!h.hc("loading")){var o=e.is_loaded,i=t(n.target);if(e.is_expanded)i.closest(".m-title").length&&(e.collapse(),o&&d(!1));else if(!i.closest(".m-follow").length)return e.expand(),o?d(!0):h.ac("loading"),!1}}),h}function y(e,n){var o=e.app,i=moot.language,a=e.is_stub?t(".m-comment-head",o.root):t(u(n?"seed":"reply",e)),r=o.user.is_admin,l=e.moot.match_count>=0,s=t(".m-unspam",a);return e.uploads=x(e.body.join("")),t(".m-post",a).data("post",e),t(".m-time",a).tooltip2({prefix:"m-",timeout:500}),e.user.is_admin&&t(".m-name",a).after(t("<span/>",{text:i.admin}).ac("admin")),e.root=a.mousemoved(),e.is_new&&a.ac("is-new"),t(".m-body",a).on("render",function(){function n(t){a.html(moot.format(e.body,t,l)),r.tc("closed",!t).tc("opened",t),s.html((t?i.less:"")+"&hellip;"),o.emit("format",a,e)}var a=t(this),r=a.parent(),s=t(".m-show-all",r),c=e.is_expanded;a.html(moot.format(e.body,c,l)),o.emit("format",a,e),(e.has_more||e.body[1])&&(r.ac("expandable "+(c?"opened":"closed")),s.html((c?i.less:"")+"&hellip;").click(function(){e.is_loaded?n(!e.is_expanded):s.ac("loading"),e.toggle(!e.is_expanded)})),e.on("more",function(){s.rc("loading"),n(!0)})}).trigger("render"),t(".m-heart",a).each(function(){function n(n,o){arguments.length||(n=e.like_count,o=!!e.is_liked);var a=n;o&&(n--,a=n?"+"+n:""),l.text(o?i.unlike:i.like),r.tc("has-likes",!o&&n>0).tc("is-liked",o).toggle(!!n||o),t("strong",r).text(n?a:"")}var r=t(this),l=t(".m-like",a),s=t(".m-like_list",a).active2("m-");o.user.is_logged&&l.click(function(){var t=!e.is_liked;n(e.like_count+(t?1:-1),t),e.likeToggle()}),e.on("like unlike spam",!0,function(o){n(),"inline"!=o&&r.mootboost(400),"spam"==e.flag&&l.remove(),("inline"!=o||e.is_liked)&&t(".m-remove",a).remove()}),r.click(function(){e.moot.is_expanded&&(r.ac("loading"),s.empty(),e.whoLikes(function(e){var n=r.rc("loading").offset();t.each(e,function(){s.append(u(o.is_forum?"face":"img",{user:this}))}),s.trigger("open").css({opacity:0}),setTimeout(function(){var e=n.left,t=s.outerWidth()/2,o=n.left>t;o&&(e+=r.outerWidth()/4-t),s.tc("edged",!o).css({opacity:""}).offset({top:n.top-s.outerHeight()-r.outerHeight()/2,left:e},10)})}))})}),t(".m-remove",a).each(function(){if(!o.user.is_logged)return t(this).add(s).remove();var n,l=t(this).tooltip2({prefix:"m-"}),c=t("<span>"+i.thanks+"</span>").ac("thanks"),d=1e3*60*B-Math.max(0,+new Date-e.time),p=e.user.path==o.user.path,m=e.removable(),f=t(".m-tooltip",l),g=t(".m-icon",l);m?r||(setTimeout(function(){p?l.remove():(m=!1,f.text(i.mark))},d),p&&d>0&&(g.text("i"),n=setInterval(function(){f.text(i.removepost+" "+h(d/1e3)),d-=1e3,0>n&&clearInterval(n)},1e3))):((e.flag||e.is_own)&&l.hide(),f.text(i.mark),g.text("!")),l.click(function(n,r){if(n.preventDefault(),!p&&!r){var s=t(u("prompt")).appendTo(o.root).active2("m-").trigger("open");return t(".m-h2",s).text(i[m?"removepost":"mark"]+"?"),t("button, a",s).click(function(){s.remove()}).filter("button").click(function(){l.trigger("click",[!0])})}m?(a.ac("loading"),e.remove(function(){r||a.remove()})):(l.parent().append(c),e.spam(function(){setTimeout(function(){c.remove()},2e3)}))}),r||!e.is_own&&!e.flag||s.remove(),s.click(function(){e.unspam(function(){l.remove(),s.replaceWith(c),setTimeout(function(){c.remove()},2e3)})})}),e.on("spam unspam",e.spam_level,function(n,o){var i=o>=1;a.tc("is-spam",i),e.is_seed&&e.moot.root.tc("is-spam",i),i&&!a.hc("is-spam")&&t(".m-body",a).trigger("render")}).on("remove",function(){a.fadeOut(function(){a.remove()})}),a}function b(e,n){var o=t("textarea",e),i=o.eq(0),a=o.last();moot.language,o.placeholder2("m-").keydown(function(n){var o=n.which;return 27==o?i.trigger("away").blur():(13==o&&(n.ctrlKey||n.metaKey)&&(n.preventDefault(),t("button",e).click()),void 0)}).focus(function(){t(document).one("mousedown",function(n){t(n.target).closest(e)[0]||i.trigger("away")})}).keypress(function(t){String.fromCharCode(t.which)&&n.user.type(i.val()+a.val(),e.closest(".m-moot").data("moot"))}),a.keydown(function(e){var t=e.which,n=this,o=n.selectionStart,i=n.value;9!=t||!o||e.ctrlKey||e.shiftKey||(e.preventDefault(),n.value=i.substring(0,o)+"   "+i.substring(n.selectionEnd),n.focus(),n.selectionEnd=o+3)});var r=t(".m-help",e).active2({prefix:"m-",trigger:t(".m-show-help",e)},function(){o[1]||r.css({top:-r.outerHeight()-10})});t.cookie2("moot.tip")||i.one("click",function(){r.trigger("open"),t.cookie2("moot.tip",1)}),i.trigger("away"),_(e,i,a,n),k(e,a,n)}function _(e,a,r,l){var s=e.hc("create"),c=t(u("preview")).appendTo(e).ac(s?"seed":"reply"),d=t(".m-title",c),p=t(".m-body",c),m=t(".m-name",c),f=moot.language,h=l.user,g=p.parent(),v=p.next().html("&hellip;");t(".m-face",c).attr("src",h.img),m.text(h.displayname),h.is_admin&&m.after(t("<span/>",{text:f.admin}).ac("admin")),a.keyup(function(){e.tc("filled",!!a.val())}),s&&a.keyup(function(e){if(-1==t.inArray(e.which,G)){var a=n(i(o(moot.fixTitle(this.value),!1),!0));d.html(a)}}),r.keyup(function(e){if(-1==t.inArray(e.which,G)){var n=t(this).val(),o=g.hc("opened"),i=moot.fixBody(n,!o),a=!!i[1]||o;p.html(moot.format(i.slice(0,o?2:1))),l.emit("format",p,{uploads:x(i.join(""))}),g.tc("expandable",a)}}),a.add(r).keydown(function(e){if(86==e.which&&(e.ctrlKey||e.metaKey)){var n=t(this);setTimeout(function(){n.trigger("keyup")},10)}}),v.click(function(){g.tc("closed opened"),v.html((g.hc("opened")?f.less:"")+"&hellip;"),r.triggerHandler("keyup")}),a.on("away",function(){a.add(r).trigger("keyup")})}function k(e,n,o){function i(e){e.preventDefault();var o=e.target.files||e.originalEvent.dataTransfer.files||[];t.each(o,function(e,i){if(/image/.test(i.type)&&4e6>i.size){var a=new FileReader;a.onload=function(a){var r=i.name,l=r.split("."),s=l[0];if(et[r]&&(s=l[0]+"-"+e,r=s+"."+l[1],i.altname=r),n[0].value+=" ["+s[0].toUpperCase()+s.slice(1)+"]("+r+")",i.data=a.target.result,et[r]=i,e==o.length-1){var c=t.trim(n.val())+" ";n.keyup().focus().val("").val(c)}},a.readAsDataURL(i)}})}if(o.conf().upload===!1&&(tt=!1),tt){var a=t("<input/>",{type:"file",multiple:"multiple",accept:"image/*"}).ac("hidden").appendTo(e),r=t("<a/>",{title:"Upload images"}).ac("post-upload").append("<em>U</em>");r.prependTo(t(".m-controls",e)).tooltip2({prefix:"m-"}),a.change(i),r.click(function(){a.click()}),e.on("drop",i).on("dragover dragleave drop",function(t){t.preventDefault(),e.tc("dragged",/over/.test(t.type))})}}function x(e){var t=[];return tt&&e&&e.replace(N,function(e,n,o){var i=et[o];i&&t.push(i)}),t}var T={logo:'<d"logo"><a title="{l.slogan}" href="https://moot.it/"><em>m</em></a></d>',online:'<d"users"><d"h3 users-title">{l.online}<em/></d><d"logged-users"/><d"anon-count"/></d>',forum:'<d"header"><d"wrap"><d"navi"><a"nav-feed" href="#!/feed"><s>{l.feed}</s><em"newcount"/></a><a"nav-all" href="#!/"><s>{l.all}</s><em"newcount"/></a><a"nav-forums"><s>{l.forums}</s></a><a"nav-online"><s>{l.online}</s><em/></a></d><d"subnavi"><d"search" id="m-search"><input type="text" name="q" placeholder="{l.search}"></d> @account; </d></d></d><d"table"><d"row"> @page; <d"sidebar"><d"forums-wrap"><d"h3 forums-title">{l.forums}</d><d"forums links"/><d"custom links"/><d"admin"/></d></d></d></d>@logo;',commenting:'<d"comment-head"><d"seed"><a"action heart"><s>a</s><strong/></a><a"like"/><a"follow"><s"icon">e</s><strong/></a></d><d"like_list"/><d"comment_count"/> @account;</d>@page;@logo;',threaded:"@account;@page;@logo;",page:'<p"message"/><d"page"><d"pagetitle"/><s"loading-text">{l.loading}</s> @create; <p"collapse-all"><a><em"icon">u</em> {l.collapse}</a></p><d"list"/><b"more-moots"/></d>',navi:'<p><a href="{href}">{title}</a></p>',admin:'<d"links"><d"h3 manage-title">{l.manage}</d><p><a"nav-settings">{l.settings}</a></p><p><a"nav-spam" href="#!/spam">{l.spam}</a></p></d><d"subs"><d"h3 subs-title">{l.subs}</d><p"yup">{l.basic}</p><p"sub-branding">{l.branding}</p><p"sub-sso">{l.sso}</p><a"button" href="https://moot.it/upgrade/" target="_new">{l.upgrade_link}&hellip;</a></d>',gallery:'<div id="m-gallery"><a"close">x</a><div id="m-title"/><nav id="m-navi"/><div id="m-media"><img id="m-img"/><iframe width="640" height="390" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></j></d></d>',browser:'<d"h2">{l.slogan}</d><a href="https://moot.it"><img src="//moot.it/m/img/home/allscreensizes.png"/></a><p><a href="http://browsehappy.com/">{l.upgrade}</a> {l.upgrade2}</p>',unverified:'<p"msg unverified"><em>{l.unver1}</em> {l.unver2}</p>',img:'<i"face" src="{user.img}" title="{user.displayname}">',face:'<a"facelink" href="#!/{user.path}" title="{user.displayname}">@img;</a>',growl:'<d"growl"><a"minify">d</a><a"destroy">x</a><d"entries"/></d><s"growlicon">L</s>',event:'<d"entry" data-path="{path}"> @face; <d"data"><d"meta"><r"name">{user.displayname}</r><s"time" data-time="{time}" title="{fullTime}">{prettyTime}</s></d><a"link">{title}</a></d></d>',help:'<a"show-help">?</a><d"help"><a"close">x</a><d"help-format"><d"help-bolded">*<s>{l.bold}</s>* ({l.single})</d><d"help-italics">_<s>{l.italics}</s>_</d><d>&gt; <s>{l.help3}</s></d><d"help-monospaced">`<s>{l.monospaced}</s>`</d><d>[<s>{l.title}</s>](<s>{l.link}</s>)</d></d><d"help-code"><d>&#45;&#45;&#45;</d> {l.help5} <d>&#45;&#45;&#45;</d><d>&#45;&#45;&#45; html</d> &lt;p&gt;{l.help6}&lt;/p&gt; <d>&#45;&#45;&#45;</d></d><d"help-post"><em>ctrl</em> + <em>&crarr;</em><s>&nbsp; {l.help2}</s></d></d>',meta:'<d"meta"><s"name">{user.displayname}</s><a"time" data-time="{time}" title="{fullTime}">{prettyTime}</a><s"cat"/><s"spammed">{l.spam}</s><s"actions"><s"reply_count"/><a"action heart"><s>a</s><strong/></a><a"follow"><s"icon">e</s></a><a"action remove" title="{l.removepost}"><s"icon">x</s><s"tooltip"></s></a></s></d><d"like_list"/>',body:'<d"body-wrap"><d"body"/><a"show-all"/><a"action like"/><a"action unspam">{l.unspam}</a></d>',seed:'<d"seed"> @face; <d"post"> @meta; <a"permlink" title="{l.fullview}"><em>7</em></a><d"title"></d> @body; </d></d>',reply:'<d"reply"> @face; <d"post"> @meta; @body; </d></d>',prompt:'<d"mask prompt"><d"panel"><d"h2"/><b>Yes</b><a>{l.cancel}</a></d></d>',more:'<d"head"/><d"get-replies"><a"to-head button" title="{l.show_old}"/><a"to-tail button" title="{l.show_more}"><em/></a></d><d"tail"/>',preview:'<d"preview expanded"><d"facelink"><i"face"><s"typing"/></d><d"post closed"><s"preview-title">{l.preview}</s><d"meta"><s"name"/><s"time">{l.now}</s></d><d"title"/> @body; </d></d>',moot:'<d"moot"><d"replies"/><d"form replyform"> @help; <textarea placeholder="{l.reply}"/><d"controls"><button title="{l.enter}">{l.replybtn}</b></d><d"writing"/></d></d>',writing:'<d"facewrap"> @img; <em"typing"/></d><s>{user.displayname} {l.writing}</s>',create:'<d"form create"> @help; <d"input-wrap"><t"input-title" rows="1"></t><t"input-body" rows="1"></t></d><d"controls"><d"select"><l>{l.select}</l><d"options"><r>{l.select}</r><ul/></d><input/></d><button title="{l.enter}"/></d></d>',account:'<d"nav-account"><a"login">{l.login}</a><a"me"><s"myname"/><em"down">5</em>@img; </a></d>',account_overlay:'<d"account overlay"><a"close">x</a><i"face"/><f"upload" target="m-upload" title="{l.avatar}"><input type="file" name="img" size="1"><b>x</b></f><d"names"><d"h3"><strong/> &bull; <a"logout">{l.logout}</a></d><d"h2"/><p"status"><s>o</s><em/> &bull; <a/></p></d><f><d"h3">{l.name}</d><s"error"/><input type="text" class="m-input" name="displayname" maxlength="50"><p>{l.nametip}</p></f><f><d"email-updated"><d"h3">{l.step}</d><p>{l.step1}</p></d><d"field email"><d"h3">{l.email}</d><s"error"/><input name="email" class="m-input" type="email" maxlength="100"><p>{l.emailtip}</p></d></f><p"unfollow"><s>e</s><em/> &bull; <a>{l.unwall}</a></p><l"maillist"><input type="checkbox"/> {l.notify} <em>{l.saved}</em></l><p"password"><a>{l.changepw}</a></p></d>',join:'<d"mask join-mask"><d"panel moot-join"><d"h2">{l.welcome}!</d><p>{l.welcome1}</p><b>{l.later}</b></d></d>',social_join:'<d"mask join-mask"><f"panel join"><i"face" /><d"h2">{l.welcome}, <span/>!</d><d"h3">{l.welcome2}</d><l"field username"><input name="username" class="m-input" required="required" placeholder="your-username" maxlength="40"><em"tip">{l.unametip}</em></l><l"terms"><input type="checkbox" name="terms" required="required" /> {l.terms} </l><p><button disabled>{l.join}</b></p></f></d>',confirm_password:'<d"h2">{l.changepw}</d><br><p><b>{l.change}</b></p>',confirm_email:'<d"h2">{l.c_email}</d><d"h3"/><p><b>{l.ok}</b></p>',confirm_account:'<d"h2">{l.c_acc}</d><d"h3">{l.c_acc1}</d><p><b>{l.ok}</b></p>',expired:'<d"h2">{l.expired}</d><p>{l.expired1}</p><p><b>{l.ok}</b></p>',confirm_error:'<d"h2"/><p><b>{l.ok}</b></p>'};t.fn.active2=function(e,n){"string"==typeof e&&(e={prefix:e}),e=t.extend({prefix:"is-"},e);var o=e.prefix+"active",i=e.trigger||t(),a=t(document);return this.each(function(){function r(){l.hasClass(o)&&(l.trigger("close"),a.off(".a2"))}var l=t(this);i.click(function(){l.trigger(l.hasClass(o)?"close":"open")}),l.on("open close",function(e){if(!e.isDefaultPrevented()){var s="o"==e.type[0];l.toggleClass(o,s),s&&(n&&n(l,i),a.on("mouseup.a2 keydown.a2",function(e){var n=t(e.target);n.closest(i)[0]||(27==e.which||"mouseup"==e.type&&!n.closest(l)[0])&&r()}))}}),t("."+e.prefix+"close",l).click(r)})},t.fn.autogrow=function(e){var n="minHeight,maxHeight,fontSize,fontFamily,lineHeight,fontWeight,padding".split(",");return this.each(function(){var o=t(this),i=o.next(".jqt-shadow"),a=o.is("textarea");o.one("keydown",function(){i=t("<"+(a?"div":"span")+"/>").attr("class","jqt-shadow").insertAfter(o),t.each(n,function(e,t){i.css(t,o.css(t))}),i.css({position:"fixed",top:"-9999em"}),a&&i.width(o.width())}).keydown(function(){setTimeout(function(){var t=o.val();i.html(t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(" ","&nbsp;"):"-"),a?o.height(i.outerHeight()+(t?e||0:0)):o.width(i.outerWidth())},1)})})},t.fn.changed2=function(){return t(":input[name]",this).change(function(){t(this).data("changed2",!0)}),this},t.expr[":"].changed=function(e){return!!t(e).data("changed2")},t.fn.toObject=function(){var e={};return this.each(function(){this.disabled||(e[this.name]=t(this).val())}),e},t.fn.mousemoved=function(e,n){e=e||"is-hover",n=n||1e3;var o;return"ontouchstart"in window?this.addClass(e):this.each(function(){var i=t(this);i.on("mouseenter mouseleave",function(a){if(!t(a.relatedTarget).data("skip-hover")){var r="mouseenter"==a.type,l=0,s=0;i.toggleClass(e,r),r?(i.on("mousemove.jqt",function(t){s-t.pageX&&(i.addClass(e),l=new Date,s=t.pageX)}),o=setInterval(function(){new Date-l>n&&(i.removeClass(e),l=new Date)},1e3)):(i.off("mousemove.jqt"),clearInterval(o))}})})};var j="placeholder"in document.createElement("input");t.fn.placeholder2=function(e){return e=e||"",j?this:this.each(function(){var n=t(this),o=t("<span/>",{"class":e+"placeholder",text:n.attr("placeholder")});n.after(o).keyup(function(){n.parent().toggleClass(e+"filled",!!n.val())}),o.click(function(){n[0].focus()})})},t.fn.sel2=function(e,n){var o=e.prefix||"";return this.each(function(){function e(e){e=e||t("."+d,c),e.removeClass(d)}function i(e){r.trigger("select",[e]).trigger("close")}var a,r=t(this).active2(o),l=r.data("api"),s=t(document),c=t("div",r),u=o+"selected",d=o+"hovered";return l?l:(r.on("open",n).click(function(){r.trigger("open"),s.bind("keydown.s2",function(n){var o=n.which,a=40==o,r=t("."+d,c);(a||38==o)&&(r.length?(e(r),r=a?r.next():r.prev()):r=t("li:"+(a?"first":"last"),c));var l=String.fromCharCode(o);if(l&&"("!=l&&"&"!=l){var s=t("li",c).filter(function(){return t(this).text()[0].toLowerCase()==l.toLowerCase()}).eq(0);s[0]&&(e(),r=s)}if(r[0]){r.addClass(d);var u=r.position().top;(0>u||u>c.height())&&c.scrollTop(c.scrollTop()+(0>u?-1:1)*c.height()),(13==o||32==o)&&i(r)}n.preventDefault()})}),r.bind("close",function(){s.unbind("keydown.s2")}),r.on("select",function(e,n){"number"==typeof n&&(n=t("li",c).eq(n));var o=n.data("value");void 0===o&&(o=n.text()),t("."+u,c).removeClass(u),n&&n.addClass(u),r.toggleClass("is-defined",!!o),t("input",r).val(o).trigger("change"),t("label",r).html(n?n.html():o),r.data("value",o),a=o}),c.on("click","li",function(e){return i(t(e.target).closest("li")),!1}).on("mouseenter mouseleave","li",function(n){e(),t(n.target).toggleClass(d,/ee/.test(n.type))}),r.data("api",{val:function(e){return void 0!==e?i(t("li:contains("+e+")",r)):a},index:function(e){return void 0!==e?i(t("li",c).eq(e)):t("li",c).index(t("."+u,c))}}),void 0)})},t.fn.tooltip2=function(e){var n=e.prefix||"",o=n+"tooltip",i=n+"hovered";return"ontouchstart"in window?this:this.each(function(){var n,a,r,l,s=t(this),n=t("."+o,s);n[0]||(n=t("<span/>",{"class":o}).appendTo(s)),n.text(s.attr("title")),s.removeAttr("title").bind("mouseenter.tip2 mouseleave.tip2",function(c){var u=/ee/.test(c.type);if(n=t("."+o,s),u){r=s.outerWidth(),a=n.outerWidth(),l=setTimeout(function(){s.addClass(i)},e.timeout||0);var d="left"==e.position?{top:0,left:-a}:"right"==e.position?{top:"35%",left:r+5}:{top:-n.outerHeight(),left:-(a/2)+r/2};n.css(d)}else s.removeClass(i),clearTimeout(l)})})};var C=/(^|\n)-{3,} *(\w*)/g,$=/<(\/?)([^3><]+)(>?)/g,q=/\[#([^\/]+)\/#\]/g,A={"<3":"a",":D":"D",":-D":"D",":d":"D",":-d":"D",":)":")",":-)":")",";)":";",";-)":";",":O":"O",":-O":"O",":o":"O",":-o":"O",":0":"O",":-0":"O",":*":"*",":-*":"*",":|":"|",":-|":"|",":(":"(",":-(":"(",":P":"P",":-P":"P",":p":"P",":-p":"P",":/":"/",":-/":"/",":'(":"'",":'-(":"'","8)":"8","8-)":"8",">:(":">",">:-(":">",">:O":"<",">:-O":"<",">:o":"<",">:-o":"<",">:0":"<",">:-0":"<"},D="";for(var S in A)D+=S.replace(/(\)|\||\*|\(|\/)/,"\\$1")+"|";D=RegExp("(^|\\s)("+D.slice(0,D.length-1)+")","g");var O=/\.{3,}/g,U=/\"([^\"]+)\"/g,E=/\s\'([^\']+)\'/g,I=/\*([^\*]+)\*/g,L=/`([^`]+)`/g,F=/_([^_]+)_/g,W=/-{2,}/g,z=/ - /g;moot.format=function(e,a,r){var l,s=e.slice(0,a?2:1).join(""),c=s.split(C),u=!0,d="";return t.each(c,function(e,a){if(0===(e+1)%3)return l=a;if(0===e%3&&(u=!u),a=t.trim(a),!a)return"";if(u)return d+=hilite2(t.trim(a.replace(q,"<mark>$1</mark>")),l,"m-");a=o(a,r),a=i(a),a=p(a),a=n(a);var s,c=(a+"\n").split("\n");t.each(c,function(e,n){n=t.trim(n),">"==n.slice(0,1)?(s||(d+="<blockquote>"),n=t.trim(n.slice(1)),s=!0):s&&(d+="</blockquote>",s=!1),(n||0!=e&&e!=c.length-1)&&(d+=n?t.browser.msie&&9>t.browser.version?n:"<p>"+n+"</p>":"<p class=m-empty/>")})}),d};var H={a:"a",b:"button",c:"code",d:"div",e:"fieldset",f:"form",i:"img",j:"iframe",l:"label",p:"p",r:"strong",s:"span",t:"textarea"};t.each(T,function(e,t){T[e]=a(t)});for(var M=0;2>M;M++)t.each(T,function(e,t){T[e]=t.replace(/\s*@(\w+);\s*/g,function(e,t){return T[t]})});var R,P={};moot.tmpl=function(e,t){return t=t||{l:moot.language},c(a(e),t)};var N=/\[([^\]]+)\]\(\s*([^\)]+)\s*\)/gi,J=/https?:\/\/[^\s\"\']+(\')?/gi,X=/(jpe?g|png|gif)$/i,Y=["facebook.com","wikipedia.org/wiki","twitter.com","github.com","google.com","vimeo.com","youtube.com/watch?v","youtu.be","d.pr","dropbox.com"];moot("format",function(e){t(".m-link",e).each(function(){var e=t(this);if("m-link"==e.attr("class")){var n=e.attr("href").split("/").slice(0,3).join("/");e.removeAttr("class").ac("favlink").prepend(t("<img/>",{src:"//icon.moot.it/"+n}))}})}),t.each(["add","remove","toggle","has"],function(e,n){t.fn[n[0]+"c"]=function(e,t){return this[n+"Class"]("m-"+e.split(" ").join(" m-"),t)}}),t.fn.mootslide=function(e,n){return e=e||100*B,this.each(function(){var o=t(this),i=o.css({opacity:0}).height();o.height(0).animate({height:i},e).animate({opacity:1,queue:!0},e,function(){o.css({height:"",opacity:"",overflow:""}),(n||t.noop)()})})},t.fn.mootboost=function(e){return this.each(function(){var n=t(this);n.ac("boosted"),setTimeout(function(){n.rc("boosted")},e||500*B)})};var B=2.718;moot(function(e){function n(){var e=i[0].clientWidth/p;i.tc("tablet",43>e).tc("mobile",25>e)}function o(e){i.tc("has-message","string"==typeof e),t(".m-message",i).text(e),e&&e.stack&&console.error(e.stack)}var i=e.root,a=e.conf(),l=e.user.is_logged;if(e.is_stub&&!/moot.it/.test(location.host))return i.html(e.name+" "+lang.notexist+' <a href="https://moot.it/'+e.name+'">'+lang.setup+" &raquo;</a>"),!1;a.sso&&i.ac("sso"),t.each(["forum","threaded","commenting"],function(t,n){e["is_"+n]&&i.html(u(n,{user:e.user})).addClass("is-"+n)});var s=t(".m-logo",i),c=t(window),d=c.outerHeight();t("a",s).tooltip2({prefix:"m-",position:"left"}),(400>d||i.offset().top>d)&&s.ac("below-fold"),e.is_commenting&&(t(".m-create",i).remove(),i.on("click","a[href^='#!']",function(e){e.preventDefault()})),e.is_threaded&&a.show_online&&i.prepend(u("online")),i.rc("app-loading loading").tc("logged",l).tc("no-logged",!l).tc("ie8",!!t.browser.msie&&9>t.browser.version).tc("webkit",!!t.browser.webkit||!!t.browser.chrome),location.hash.split("#!")[1]&&e.on("load",function(){var n="unread"==e.page.extra?t(".m-reply:last.m-is-new:first, .m-replies > :last",i):i;n[0]&&t("html, body").animate({scrollTop:n.offset().top-30},300)});var p=parseFloat(i.css("fontSize"));c.resize(n),n(),setInterval(function(){t("[data-time]",i).each(function(){var e=t(this),n=e.data("time"),o=t("span",e);n&&e.html(r(n)+(o[0]?o[0].outerHTML:""))})},1e4*B),e.on("error",o).on("waiting",function(e,t){t.on("progress",function(e){o(lang.progress[e]),3==e&&setTimeout(o,1e3)}).done(function(){o()})}).on("destroy",function(){i.ac("destroyed")}),e.channel.on("*",!0,function(e){"close"==e?setTimeout(function(){o(lang.reconnect)},100*B):o()}).on("type",function(e){e.img||(e.img="//i2.wp.com/cloudinary-a.akamaihd.net/moot/image/upload/t_d2-avatar/v1364433564/moot.jpg?ssl=1",e.displayname=lang.someone)})}),moot(function(e){function n(){e.is_commenting||setTimeout(function(){var n=t.grep(e.page,function(e){return e.is_expanded});r.parent().tc("shown",n.length>1)},1)}var o=e.root,i=t(".m-list",o),a="created",r=t(".m-collapse-all a",o).click(function(){e.page.collapse()}),l=t(".m-more-moots",o).click(function(){e.page.more()});e.is_commenting&&r.parent().remove(),e.on("before:load",function(o){l.hide(),o.on("load more",function(e){l.text(o.available).css("display",o.available>0?"block":"none"),n(e)}).on("before:more more",function(e){l.tc("loading","more"!=e)}).on("before:moot",function(e){w(e,o).prependTo(i),e.root.ac(a)}).on("moot",function(r,l){if(r.root&&r.root.hc(a))setTimeout(function(){r.root.rc(a)},500*B);else if(l){var s=w(r,o).prependTo(i);r.from_channel&&s.mootslide()}else w(r,o).appendTo(i);r.on("expand collapse",n);var c=r.page;"moot"==o.type&&c.title&&!e.is_commenting&&t("<a/>",{text:c.title}).ac("back").appendTo(i).click(function(){e.load(c.path)}),e.emit("topic",r,l)}).on("remove",function(e){e.root.fadeOut(function(){e.root.remove()})})})}),moot(function(e){function n(e){var t=e.split("@"),n="#!/"+(t[1]?"@"+t[1]:e.split("/").slice(2).join("/"));return n}function o(){var n=t(this);moot.admin?(moot.admin(e,i),n.trigger("click")):(n.ac("loading"),t.getScript("//cdn.moot.it/1.7.6/admin.min.js",function(){n.rc("loading"),moot.admin(e,i),n.trigger("click")}))}if(!e.is_commenting){var i=e.root,a=e.user,r=moot.language,l=t(".m-header",i),s=t(".m-page",i),c=t(".m-sidebar",i),d=(t(".m-navi",i),t(".m-nav-feed",i)),p=t(".m-forums-wrap",c),m=t(".m-forums",p),f=t(".m-forums-title",p),h=t(".m-custom",c),g=t(".m-nav-all",i),v=t(".m-list",i),w=t(".m-pagetitle",i);if(i.off("click.ml").on("click.ml","a[href^='#!']",function(n){if(!e.is_forum&&t(n.target).hc("face"))return!1;if(!n.metaKey&&!n.ctrlKey){n.preventDefault();var o=t(this),i=o.attr("href").slice(3);("feed"!=i||a.is_logged)&&(o.ac("loading"),e.load(i))}}),p.active2({prefix:"m-",trigger:t(".m-nav-forums",l)},function(e,t){var n=t.offset();e.offset({top:n.top+t.outerHeight()+10,left:n.left-(e.outerWidth()-t.outerWidth())/2})}),a.on("login logout",!a.is_logged,function(){d.attr("title",a.is_logged?"":r.login1)}),e.html){h.html(e.html);var y,b=[];t("a",h).each(function(){var o=t(this),i=o.attr("href");if(!i||"#!/"==i.slice(0,3)){var a=e.path+"/"+(i?i.slice(3):moot.urlify(o.text())),r={title:o.text(),path:a,href:n(a)};o.replaceWith(u("navi",r)),delete r.href,a.split("#")[1]||o.hasClass("non-category")||(e.getCategory(a)||(y=!0),m.add(f).remove(),b.push(r))}}),b.length&&b.length!=e.categories.length&&(y=!0),a.is_admin&&y&&e.setCategories(b),t(".moot-footer",h).remove().appendTo(c)}m[0]?e.on("categories",e.categories,function(o){o=o||e.categories,m.empty(),t.each(o||[],function(e,o){o=t.extend({},o,{href:n(o.path)});var i=t(u("navi",o)).appendTo(m);t("a",i).tc("has-new",!!o.has_new)})}):f.remove();var _=t(".m-admin",i);if(a.is_admin){_.html(u("admin")),t(".m-nav-settings",_).one("click",o),t("<a>"+r.edit+"</a>").ac("edit-cats").appendTo(f).one("click",o);var k=e.products||[];t(".m-subs p",c).each(function(e){var n=t(this),i=n.attr("class").split("m-sub-")[1];(0==e||t.inArray(i,k)>-1)&&n.ac("yup").one("click",o)}),2==k.length&&t(".m-subs",c).ac("has-all")}else _.remove();p.on("click",".m-links a",function(){p.trigger("close")}),e.on("before:load",function(o){v.empty().ac("loading"),i.attr("class",t.trim(i.attr("class").replace(/m-\w+page/,""))),i.rc(e.page.type+"page"),w.html(r.loading).css("display",""),t(".m-selected",i).rc("selected"),t("[href='"+n(o.path)+"']",i).add(s).ac("loading")}).on("load",function(e){var o=t("#m-search input",i),a=e.title;v.rc("loading"),i.ac(e.type+"page"),w.text(a),t(".m-loading",i).rc("loading has-new"),t("[href='"+n(e.path)+"']",i).ac("selected"),o.on("focus blur",function(e){o.closest(".m-subnavi").tc("focus","f"==e.type[0])}),"search"==e.type?(e.length?(e.old_query&&w.show().html(r.showing+" &ldquo;<strong>"+a+"</strong>&rdquo;"+"<em>"+r.noresults+" &ldquo;"+e.old_query+"&rdquo;"),e.suggestion&&w.show().html("<em>"+r.mean+" <a href='#!/?"+e.suggestion+"'>"+e.suggestion+"</a>?")):w.show().html(r.noresults+" &ldquo;<strong>"+a+"</strong>&rdquo;"),o.val()!=w&&o.val(a).keyup()):o.val(""),e.size||"spam"!=e.type||w.append("<em>"+r.nospam+"</em>")}),a.on("newcount",function(e){function n(e,n){t(".m-newcount",e).toggle(n>0).text(n)}n(d,e.feed),n(g,e.all),e.all||t(".m-has-new",c).rc("has-new")}),t("#m-search",l).each(function(){var n=t(this),o=t(":input",n).placeholder2("m-");o.keyup(function(n){if(13==n.which){var o=t.trim(this.value);o&&e.search(o)}}),t(".m-placeholder",n).click(function(){o.focus()})}),history.pushState&&(e.on("load",function(e){var t=e.path,o=n(t),i=location.hash.split("::")[0];e.is_init||"/"!=t[0]||o==i||history.pushState(null,null,o)}),t(window).on("popstate",function(){var t=unescape(location.hash.split("#!/")[1]||"");(t||e.page.path!=e.path)&&(e.page.is_init||e.load(t))}))}});var K=[9,16,27,33,34,35,36,37,38,45,91],Q=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),V=80;moot(function(e){function n(){return u.is(":visible")&&!u.data("value")?(u.click(),d.prop("disabled",!0),u.one("select",function(){d.prop("disabled",!1)}),!1):!0}var o=t(".m-create",e.root),i=t("textarea",o),a=i.eq(0).autogrow(),r=i.eq(1).autogrow(30),l=moot.language,s=e.user.is_logged,c=e.conf();if(c.sso&&!s)return c.login_url?o.html(t("<a/>",{html:l.login_and+" "+l.start.toLowerCase(),href:c.login_url}).ac("sso-link")):o.remove();a.attr("maxlength",V),i.on("focus away drag",function(e){var t="f"==e.type[0],n=!!a.val();n||(a.attr("placeholder",l[t?"title":"start"]),r.attr("placeholder",t?l.body:"")),o.tc("focused",t||n||!!r.val())}),b(o,e),a.keydown(function(e){if(!(""+getSelection())){var n=e.which;if(Q)return 13==n?!1:0;if(!e.metaKey&&!e.ctrlKey&&-1==t.inArray(n,K)){var o=this.value.length;return 13==n||8!=n&&39!=n&&o>=V||o==this.selectionStart&&39==n||40==n?(r.focus(),!1):void 0}}}),r.keydown(function(e){if(!(""+getSelection())){var t=e.which,n=this.selectionStart,o=this.value.substr(0,n).split("\n").length;return 1==o&&38==t||(37==t||8==t)&&!n?(a.focus(),!1):void 0}}).focus(function(){a.val()||a[0].focus()});var u=t(".m-select",o);e.on("categories",!0,function(){var n=t("ul",u).empty();t.each(e.categories||[],function(e,o){n.append(t("<li/>",{"data-value":o.path,text:o.title}))}),u.sel2({prefix:"m-"})}).on("before:load",function(e){t("li[data-value='"+e.path+"']",u).click()});var d=t("button",o).text(s?l.post:l.login_and+" "+l.post.toLowerCase());d.click(n),d.click(function(c){if(c.preventDefault(),s&&n()){var p=t.trim(r.val()),m={path:u.data("value"),title:a.val(),body:p},f=x(p);if(f[0]&&(m.files=f),e.is_forum&&"page"==e.page.type&&m.path!=e.page.path)return e.load(m.path,function(){d.click()
});i.val("").trigger("away").blur(),e.create(m).fail(function(n){t(".m-created",e.root).remove(),a.val(m.title).focus(),r.val(p.join("")),o.prepend(t("<div/>").ac("err tooltip").text(l.error)),m.error=n,e.log("error create:failed",m)})}})});var G=[16,27,33,34,35,36,37,38,39,40,45,91],Z={};moot(function(e){e.channel.on("reconnect close",function(){t(".m-form",e.root).each(function(){var e=t(this),n=t("textarea",e),o=e.closest(".m-moot").data("moot");Z[o?o.path:"@"]=o?n.val():{title:n.eq(0).val(),body:n.eq(1).val()}})}),e.one("load",function(n){t.each(Z,function(o,i){var a=n.find(o);i&&(a?t("textarea",a.root).val(i).focus():"@"==o&&(t(".m-input-body",e.root).val(i.body),t(".m-input-title",e.root).val(i.title).focus()))}),Z={}})}),moot("topic",function(e){var n=t(".m-form",e.root),o=t("textarea",n).autogrow(30),i=t("button",n),a=moot.language,r=e.app,l=r.conf(),s=r.is_commenting?a.post:a.replybtn,c=r.user.is_logged;return c||(s=a.login_and+" "+s.toLowerCase()),l.sso&&!c?(n.html("<div class='m-writing'/>"),l.login_url?n.append(t("<a/>",{href:l.login_url+"#!"+escape(e.path),html:s+"&hellip;"}).ac("sso-link")):0):(i.text(s),b(n,r),o.on("focus away",function(e){n.tc("focused","f"==e.type[0]||!!o.val())}),e.seed.is_stub&&(o.attr("placeholder",e.replies.length?a.comment:a.comment1),e.one("reply",function(){o.attr("placeholder",a.comment)})),i.click(function(i){i.preventDefault();var l=t.trim(o.val()),s={body:l},u=x(l);l&&c&&(o.val("").trigger("away").trigger("keydown").blur(),u[0]&&(s.files=u),e.reply(s).fail(function(i){t(".m-created",e.root).remove(),o.val(l).focus(),n.prepend(t("<div/>").ac("err tooltip").text(a.error)),r.log("error reply:failed",{moot:e.path,body:l,error:i})}))}),void 0)});var et={},tt="FormData"in window&&"File"in window;moot("load",function(){et={}}),moot(function(e){function n(i,a){if("undefined"==typeof _gat)return t.getScript("//google-analytics.com/ga.js",function(){n(i,a)});var r=_gat._createTracker(o);r._trackEvent("Moot: "+i,a,e.user.path||"anonymous")}var o=e.analytics&&e.analytics.ga;o&&(e.channel.on("login join",function(){setTimeout(function(){n("login",e.page.path)},10)}),e.on("before:load",function(e){e.one("load",function(){n("load",e.title),"moot"==e.type&&n("topic",e.title)}),e.on("before:moot",function(e){n("post",e.seed.title)}).on("moot",function(e){e.on("load before:reply like",function(t){"load"==t&&(t="topic"),"before:reply"==t&&(t="post"),n(t,e.seed.title)})})}))});var nt;moot(function(e){function t(e,t){document.title=e.displayname+" "+t,setTimeout(function(){document.title=nt},o)}nt||(nt=document.title);var n=e.is_forum,o=(e.user,1e3*B);e.channel.on("moot reply",function(e,n){n.seed&&(n=n.seed),n.path&&t(n.user," – "+(n.title||n.body[0]).slice(0,32))}).on("type",function(e){t(e,moot.language.writing)}),n&&e.on("load",function(e){e.title&&(document.title=e.title+" | "+nt)})});var ot=".m-image, .m-youtube-link, .m-youtu-link, .m-vimeo-link";moot(function(e){t(".m-page",e.root).on("click",ot,function(e){var n=t(e.target);if(!n.hc("vimeo-link")||parseInt(n.attr("href").split("/")[3])){e.preventDefault();var o=t("#m-gallery");o[0]||(o=t(u("gallery")).active2("m-").appendTo("body"));var i=t("#m-navi",o).empty(),a=t("#m-media"),r=t("iframe",a),l=t("img",a),s=t(ot,n.closest(".m-body")),c=n.closest(".m-moot");t("#m-title",o).text(t(".m-title",c).text()),s=s.filter(function(){var e,n,o=t(this),s=o.attr("href");if(/youtu/.test(o.attr("class")))n=(s.split("?v=")[1]||s.split("/").slice(-1)[0]).split("&")[0],e="//www.youtube.com/embed/"+n+"?autoplay=1",s="//i1.ytimg.com/vi/"+n+"/mqdefault.jpg";else if(o.hc("vimeo-link")){if(n=s.split("/").slice(-1)[0],!parseInt(n))return!1;e="//player.vimeo.com/video/"+n+"?autoplay=1",t.getJSON("//vimeo.com/api/v2/video/"+n+".json?callback=?",function(e){c.attr("src",e[0].thumbnail_small)}),s=""}et[s]&&(s=et[s].data);var c=t("<span/>").css("backgroundImage","url("+s+")").appendTo(i).click(function(){var n=t(this);t("span",i).rc("active"),n.ac("active"),r.attr("src",""),a.tc("is-video",!!e),e?r.attr("src",e):l.attr("src",s)});return e&&c.ac("video"),!0}),i.toggle(s.length>1),o.on("open",function(){var e=t(window).scrollTop(),n=t(document);o.css({width:n.outerWidth(),height:n.outerHeight(),paddingTop:e}),a.css({height:screen.availHeight-i.filter(":visible").height()-20})}).on("close",function(){r.attr("src",""),l.attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==")}),o.on("click",function(e){(e.target==o[0]||e.target==a[0])&&o.trigger("close")}),t("span",i).eq(s.index(n)).click(),o.trigger("open")}})}),moot(function(e){var a=e.root,r=t(u("growl")).appendTo(a),l=r.eq(0),s=r.eq(1),c=t(".m-entries",r);t(".m-destroy",r).click(function(){c.empty(),r.hide()}),t(".m-minify",l).add(s).click(function(){r.toggle()}),e.channel.on("moot reply",function(d,p){if(p){p.seed&&(p=p.seed);var m=e.page,f=m.find(p.path);if(!f||"moot"!=m.type&&!t(".m-focus",f.moot.root||1)[0]){t(".m-logo",a).remove();var h=p.title||p.body&&p.body[0].slice(0,90)||"";h=h.replace(J,function(e){return e.split("/").slice(-1)}).replace(N,function(e,t){return t}),90==h.length&&(h=h.slice(0,h.lastIndexOf(" "))+"&hellip;"),h=n(i(o(h,!0)));var v={time:+new Date,user:p.user||p,title:h,path:p.path},w=t(u("event",v)).prependTo(c);if(t(".m-link",w).click(function(){function t(){o.root.click(),setTimeout(function(){g(o.find(p.key).root)},500)}var n=m.find(p.path),o=n?n.seed?n:n.moot:m.find(p.moot.path);o?o.is_loaded?o.is_expanded?o.is_expanded&&g(n.root):t():o.load(t):m.path==p.moot.page.path?m.lift(p.moot.path,function(){p=m.find(p.path),p&&g(p.root)}):e.is_forum&&e.load(p.moot.path,function(){p=m.find(p.path),p&&g(p.root)})}),!l.is(":visible")){var y=setTimeout(function(){r.toggle()},1500*B);l.one("mouseenter",function(){clearInterval(y)})}l.show().mootboost(200),s.hide(),t(".m-entry",l).length>3&&l.ac("large")}}}).on("remove",function(e){t("[data-path='"+e.path+"']",l).remove(),t(".m-event",c)[0]||r.hide()})}),moot(function(e){function n(n){t("a.m-facelink",n).each(function(){t(this).tc("online",!!e.users.find(t(this).attr("href").slice(3)))})}if(e.users){e.on("before:load",function(e){e.on("moot",function(e){e.on("load more reply",!0,function(o,i){var a=i&&i.root||e.root;n(a),t(".m-like_count",a).on("open",function(){setTimeout(function(){n(t(".m-like_list",a))},500)})})})}),e.channel.on("enter leave",function(n,o){o&&t("a.m-facelink[href$='"+o.path+"']",e.root).tc("online","enter"==n)});var o=e.root,i=t(".m-nav-online",o),a=t(".m-users",o),r=moot.language;if(e.conf().show_online===!1)return i.remove();a[0]||(a=t(u("online")).appendTo(t(".m-sidebar",o))),a.active2({prefix:"m-",trigger:i},function(e,t){var n=t.offset();e.offset({top:n.top+t.outerHeight()+10,left:n.left-a.outerWidth()+t.outerWidth()})}),a.each(function(){function n(e){return t("[href*='"+e.path+"']",l)}function o(e){var o=n(e);return o[0]||(o=t(u("face",{user:e})).tooltip2({prefix:"m-"}).appendTo(l),e.is_admin&&(o.ac("is-admin"),t(".m-tooltip",o).append("<em> ("+r.admin+")</em>")),t("img",o).removeAttr("title")),o}var i=t(this),l=t(".m-logged-users",i),s=t(".m-users-title em",i).add(t(".m-nav-online em",e.root)),c=t(".m-anon-count",i),d=e.users&&e.users.online;return d?(l.on("click","a",function(){a.trigger("close")}),e.channel.on("enter",function(e){e&&o(e).mootboost(500)}).on("leave",function(e){e&&n(e).fadeOut(function(){t(this).remove()})}).on("away return",function(e,t){n(t).tc("inactive","away"==e)}).on("type",function(e){var o=t("<em/>").ac("typing").appendTo(e.path?n(e):c);setTimeout(function(){o.remove()},1e3*B)}).on("enter leave away return",!0,function(){var t=d.length,n=e.users.anon_count;s.text(t).add(l).toggle(t>0),c.toggle(n>0).html((t>0?"+":"")+"<em>"+n+"</em> "+r[1==n?"anon_1":"anon"])}),t.each(d,function(e,t){o(t)}),void 0):i.hide()})}}),moot(function(e){function n(e,n,o){if(i.test(e)){var a;return t(".m-facelink[href$='"+e+"']",o).each(function(){return a=t(".m-body p:contains('"+n+"'):first",t(this).next()),a[0]?!1:void 0}),a}}var o,i=/^@[a-z0-9\-]{5,}$/i;t(document).mousedown(function(e){o&&e.target!=o[0]&&o.hide()}).mouseup(function(e){setTimeout(function(){var n=t(e.target),i=window.getSelection,a=i?""+i():document.selection.createRange().text;i&&(i=i(),t(i.anchorNode).closest("p")[0]!=t(i.focusNode).closest("p")[0]&&(a="")),t.trim(a)&&!n.hc("name")&&n.closest(".m-post")[0]&&(o=t("#m-quote"),o[0]||(o=t("<a/>",{id:"m-quote",text:'"'}).data("skip-hover",!0).appendTo("body")),o.show().css({top:e.pageY-17,left:e.pageX+5}),o.unbind("click").click(function(){var e=t("textarea",n.closest(".m-moot")),i=n.closest(".m-post").prev().attr("href").slice(3),r=e.val();r&&(r+="\n"),r+="> "+i+"\n",r+="> "+a+"\n",g(e,10,function(){e.val(r).trigger("keyup").trigger("keydown");var t=e[0];t.focus(),t.selectionStart=t.selectionEnd=t.value.length}),o.hide()}))},1)}),e.on("format",function(e,o){t("blockquote",e).each(function(){var e=t(this),i=t("p:first",e),a=i.text(),r=t("p:gt(0)",e).text(),l=o.moot?o.moot.root:e.closest(".m-moot"),s=n(a,r,l);s&&(i.ac("user-path"),e.ac("quote").on("mouseenter mouseleave click",function(e){"click"==e.type?g(s):t("body").is(":animated")||s.tc("boosted",/ee/.test(e.type))}))})})}),moot(function(e){var n=/.+@.+\..+/i,o=/.{5,}$/,i=e.root,a=e.user,r=e.conf(),l=moot.language,s=t(".m-nav-account",i),c=t(u("account_overlay")).prependTo(i),d=t(".m-h2",c).text(a.displayname),p=t(".m-me",s),f=!!e.conf().sso;if(!e.user.is_logged)return f&&t(".m-login",i).remove(),void 0;t(".m-myname",s).text(e.user.displayname),c.active2({prefix:"m-",trigger:p},function(){var e=p.offset();c.offset({left:e.left+(r.rtl?0:p.outerWidth()-c.outerWidth()),top:e.top+p.outerHeight()+10})}),t(".m-names strong",c).text(a.path),t.each(["displayname","email"],function(){t("[name='"+this+"']",c).val(a[this])}),t(".m-logout",c).click(function(){i.ac("loading"),a.logout()}),t(".m-status",c).each(function(){function e(){var e=a.is_visible;t("em",n).text(e?"online":"invisible"),t("a",n).text(e?"hide":"show"),n.tc("invisible",!e)}var n=t(this);t("a",n).click(function(){n.ac("loading"),a.hideToggle(function(){n.rc("loading"),e()})}),e()}),t(".m-unfollow",c).each(function(){var e=t(this);a.on("follow unfollow",!0,function(){var n=a.subscription_count;e.toggle(n>0),t("em",e).text(n)}),t("a",e).click(function(){e.fadeOut(400),a.unfollowAll()})});var h=t(".m-face",c).attr("src",a.img),g=t(".m-preview img, img[title='"+a.displayname+"']",i).add(h),v=t(".m-upload",c);if(t(".m-me",s).one("click",function(){v.jsonrpc({api:"https://api.moot.it",method:"userUpdate",session:e.channel.session}).on("done",function(e,t){g.attr("src",t).rc("loading"),a.emit("update",{img:t})}),v.tooltip2({prefix:"m-"})}),t(":file",v).bind("change drop",function(e){t.each(e.target.files||[],function(e,t){if(t.type.match("image.*")&&15e5>t.size){var n=new FileReader;n.onload=function(e){g.attr("src",e.target.result)},n.readAsDataURL(t)}}),"change"==e.type&&t("button",v).click()}).bind("dragenter dragleave change",function(e){t(this).tc("hover",/enter/.test(e.type))}),t("form:gt(0)",c).each(function(){function e(){var e=t.trim(c.val()),i="email"==p?n:o;return e!=a[p]&&i.test(e)}var s=t(this),c=t("input",s),u=t("<button/>",{text:l.change,disabled:!0}).appendTo(s),p=c.attr("name");c.keyup(function(){var t=e();u.show().prop("disabled",!t),this.value==a[p]&&u.hide(),t&&s.rc("is-error")}),s.submit(function(n){if(!e())return!1;n.preventDefault(),s.ac("loading").rc("valid");var o={},u="email"==p;o[p]=c.val(),u&&(o.url=r.pageUrl),a.update(o,function(){if(s.rc("loading").ac("updated"),!u){var e=t("<span class='m-saved'>"+l.saved+"</span>").appendTo(s);setTimeout(function(){e.remove()},1e3),d.add(".m-nav-account .m-name",i).text(c.val())}}).fail(function(e){s.rc("loading").ac("is-error"),t(".m-error",s).text(/taken/.test(e)?l[p+"_taken"]:l.invalid)})})}),t(".m-maillist input").prop("checked",!!a.maillist).change(function(){var e=t(this);a.update({maillist:!!this.checked},function(){e.parent().mootboost()})}),t(".m-password a",c).click(function(){var n=t.extend({host:r.url.host,l:l.$code,rtl:r.rtl},e.channel.session);e.brand_logo&&(n.logo=e.brand_logo),e.brand_color&&(n.bgcolor=e.brand_color),m("https://moot.it/auth/1.7.6/password.html?"+t.param(n),300,335)}),a.unverified){i.ac("is-unverified"),t(".m-page",i).prepend(u("unverified")).find(".m-unverified a").click(function(){t(".m-nav-account a").click()});var w=t("<p/>").ac("incomplete").html(l.unver3);t(".m-email .m-h3",c).append(t("<span/>").ac("badge").text(l.unver)).after(w),t("a",w).click(function(){a.sendValidationCode({forumname:e.name,url:r.pageUrl},function(){w.text(l.unver4)})})}f&&t(".m-h3, form, .m-password, .m-maillist",c).remove()}),moot(function(e){function n(){function n(n,o){return/invalid/.test(o)?(g.empty(),d.append(h),f.url=e.conf().pageUrl,delete f.path,"sendValidationCode"==n&&(f=f.url),p[n](f,function(){g.html(u("expired"))}).fail(function(e){g.html(u("confirm_error")),t(".m-h2",g).text(t.isArray(e)?e[0]:e)})):void 0}var a=(unescape(location.hash).split("!")[1]||"").split("/"),r=moot.language,l=a[0],s=a[1],c=a[2];if(!o&&/password|account|email/.test(l)&&i.test(c)&&s){o=!0;var d=e.root,p=e.user,f={confcode:s,email:c},h=t("<div class='m-mask'><div class='m-panel'/></div>"),g=t(".m-panel",h).append(u("confirm_"+l)),v=t(".m-h3",g);if(p.is_logged||(f.path=e.page.path),v.text()||v.text(c),h.on("click","button",function(){h.remove(),"localhost"!=location.hostname&&history.replaceState&&history.replaceState(null,null,"#")}),t(document).one("keydown",function(e){27==e.which&&h.remove()}),"password"==l)return p.is_logged?!0:p.checkResetCode(f,function(){f.id=f.email,delete f.email,d.append(h),t("button",h).click(function(){t.extend(f,{host:e.conf().url.host,l:r.$code,rtl:e.conf().rtl},e.channel.session),e.brand_logo&&(f.logo=e.brand_logo),e.brand_color&&(f.bgcolor=e.brand_color),m("https://moot.it/auth/1.7.6/forgot.html?"+t.param(f),300,270)})}).fail(function(e){f.id=f.email,delete f.email,n("resetPassword",e)});if("account"==l||p.is_logged){var w="account"==l;p[w?"confirmAccount":"confirmEmail"](f,function(){d.append(h),w?(d.rc("is-unverified"),t(".m-unverified",d).remove()):t(".m-email input",d).val(c)}).fail(function(e){n(w?"sendValidationCode":"update",e)})}else d.append(h),t(".m-h2",h).text(r.login1),t("button",h).click(function(){t(".m-login",d).click()});t(window).off("popstate.confirm")}}var o,i=/.+@.+\..+/i;t(window).on("popstate.confirm",n),setTimeout(n,t.browser.msie?500:0)}),moot(function(e){function n(){var n;o.like&&(n=e.page.like(o.path)),o.reply?(delete o.reply,e.page.reply(o,function(e){g(e.root)})):o.create&&(delete o.create,e.create(o),n=t(".m-moot:first",e.root)),n&&n.root&&g(n.root)}var o,i=/^[a-z0-9\-]{5,}$/i,a=window.localStorage||{},r=e.conf(),s=moot.language,c=e.user,d=e.root,p=t();r.sso||(d.on("click",".m-form button, .m-login, .m-like",function(n,i){if(!e.user.is_logged){var l=t(this),c=l.closest(".m-form"),u=t("textarea",c),d=l.closest(".m-moot").data("moot"),p={referrer:a["moot.referrer"],host:r.url.host,url:r.pageUrl,path:e.page.path,l:s.$code,rtl:r.rtl};e.brand_logo&&(p.logo=e.brand_logo),e.brand_color&&(p.bgcolor=e.brand_color),i&&t.extend(p,i),o={body:u.last().val()};var f=x(o.body);f[0]&&(o.files=f),l.is(".m-like")?(o.like=!0,o.path=(l.closest(".m-post").data("post")||l.closest(".m-moot").data("moot")).path):d?(o.reply=!0,o.path=d.path):c.length&&(o.create=!0,o.title=u.first().val(),o.path=t(".m-select",c).data("value")),(window.mootlogin||m)("https://moot.it/auth/1.7.6/?"+t.param(t.extend(p,e.channel.session)),360,400)}}),e.channel.on("login",function(o){e.reload(o),n(),o.user.join&&(p=t(u("join")).appendTo(d),t("button",p).click(function(){p.remove()}))}).on("join",function(o){function a(){m.prop("disabled",!g.is(":checked")||!h.parent().hc("ok"))}p.trigger("close");var r=t(u("social_join")).appendTo(d),m=t("button",r),f=o.user;t(".m-face",r).attr("src",f.img),t(".m-h2 span",r).text((f.name||f.displayname).split(" ")[0]),t(".m-terms a").attr({href:"https://moot.it/terms",target:"_new"});var h=t(":text",r).val(f.username).keyup(function(){var e=i.test(this.value),n=this.value.length;t(this).parent().tc("ok",e).tc("fail",n>3&&!e),a(),n>2&&h.next().text(s[e?"uname_len":"username_fail"])}),g=t(":checkbox",r).change(a);h.triggerHandler("keyup"),t("form",r).submit(function(){var i={secret:o.secret,username:h.val(),provider:o.provider,path:e.page.path};return c.join(i,function(){d.rc("is-join"),n()}).fail(function(e){if(/taken/.test(e)){var n=h.parent().ac("is-error").rc("ok");t(".m-error",n).length||t("<p/>").ac("error").text(l.uname_taken).insertAfter(h)}}),!1})}))}),t(function(){t(".moot[href]").moot(),t(".moot .moot-url[href]").each(function(){var e=t(this);e.closest(".moot").moot(e.remove().attr("href"))})}),t.fn.moot=function(e,n){return e=e||{},"string"==typeof e&&(e={url:e}),this.each(function(){var o,i=t(this),a=i.attr("href"),r=location.hash.split("#!")[1],l=i.data().pagetitle||document.title,s=moot.language,c=t("<div class='m-loading-text'>"+s.loading+"</div>");if(a||(a=t(".moot-url",i).remove().attr("href")),t("*",i)[0]&&!t(".m-page",i)[0]&&(o=i.html()),t.extend(e,i.data(),{mootTitle:i.attr("title"),pageTitle:l.slice(0,30*B)||"Untitled",url:(a||e.url).toLowerCase(),pageUrl:location.href.split("#")[0],rtl:"rtl"==t("html").attr("dir")}),r&&"/"==r[0]&&(e.path=unescape(r)),i.is("a")){var d=t("<div/>").attr({"class":i.attr("class"),"data-url":e.url});i.replaceWith(d),i=d}i.addClass("moot m-app-loading"),t("*",i)[0]||i.empty(),i.prepend(c);try{moot("error",function(e){"currentforum:invalid"==e&&i.html(s.badforum+': "'+this.name+'"')}),moot(e,function(e){e.html=o,e.root=i,t.isFunction(n)&&n.call(e,e),c.remove()})}catch(p){i.rc("app-loading"),/json-rpc/.test(p.message)&&i.ac("no-support").html(u("browser")).append('<img style="display:none" src="//oldbrowser.moot.it/'+escape(navigator.userAgent)+'">')}})}}(!this.top,jQuery),function(e){"use strict";function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e,n){return t(t({},e),n)}function o(e,t,o){if(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&lt;mark&gt;/g,"<mark>").replace(/&lt;\/mark&gt;/g,"</mark>"),!t)for(var r in a){var l=a[r].detect;if(l&&l.test(e)){t=r;break}}var s="",c=[],u=n(a.common,a[t]);for(var r in u){var d=u[r],p=r.split(",");d&&"detect"!=r&&e.replace(d,function(){for(var e,t,n,o,i=0,a=p.length,r=arguments;a>i;i++)e=p[i],t=a>1?1:0,n=r[i+t],o=r[a+t],4!=r.length||t||(n=r[1]||r[0],o=r[2]),i&&(o+=[].slice.call(r,1,i+1).join("").length),c.push([o,o+n.length,e])})}c=c.sort(function(e,t){return e[0]-t[0]});for(var m,f,h,g=0,v=0,w=0,y=c.length;y>v;v++)m=c[v],f=c[v-1]||[],h=c[v+1]||[],w>m[0]||m[0]==h[0]&&h[1]>m[1]||m[1]>w&&(w=m[1],s+=e.substring(g,m[0]),s+='<span class="'+(o||"")+m[2]+'">'+e.substring(m[0],m[1])+"</span>",g=m[1]);return s+=e.substring(g),s=s.replace(i,"<a href='$1' target='_a'>$1</a>"),"<pre class='"+o+"syntax "+o+(t||"common")+"'>"+s+"</pre>"}var i=/(https?:\/\/[\da-z\.\-]+\.[a-z\.]{2,6}[#&+_\?\/\w\.\-=]*)/gi,a={common:{comment:/\/\*[\w\W]*\*\/|\/\/.*\n|\#\s.*\n/gm,string:/'[^']*'|"[^"]*"/g,keyword:/\b(none|true|false|and|array|catch|class|def|delete|echo|end|else|elseif|exit|extends|except|finally|for|foreach|global|if|import|local|module|new|object|or|package|print|private|protected|public|rescue|return|require|self|struct|static|sub|switch|then|this|throw|try|unsigned|var|while)\b/gi,operator:/\+|\!|%|\-|&lt;|&gt;|&amp;|;|:|\||\*|\=/g,bracket:/[{}\[\]\(\)]/g,number:/\b\d+\.?\d*\b/gi,accent1:/\b(boolean|const|void|char|short|int|integer|long|float|double|string)\b/g,"accent2,bracket":/\b(\w+)\s?(\()/gi},html:{operator:0,accent1:0,accent2:0,comment:/&lt;\!--[\w\W]*--&gt;/g,"bracket,accent1":/(&lt;\/?)(\w+)/g,keyword:/doctype/i,"accent2,operator":/([\w-]+)(=)/g,bracket:/&lt;|&gt;/g,detect:/^\s*&lt;/},java:{accent3:/@\w+\b/gi},js:{accent1:/\$|window|document|setTimeout|setInterval|console/g,accent3:/\/.+\/[igm]{0,3}/g,detect:/var\s*\w+\s*=/},css:{keyword:/none|inline|inline-block|block|rgba?|hsla?|solid|dotted/gi,"number,accent1":/(\d+\.*\d*)(px|em|rem|%)/gi,string:/#[a-f0-9]{3,6}/gi,accent1:/\s?([\-\w,\. \s#]+){\s?/gi,accent2:/\b([\-\w]+):\s?/gi,accent3:/\b(before|after|active|hover|focus)\b/gi},python:{accent3:/"""[\w\W]*"""/gm},ruby:{accent1:/\b(String|ArgumentError|puts|Thread|Errno::|Exception)\b/g,accent3:/[@:]\w+/g},markdown:{keyword:/[\*_].+[\*_]/gi,accent1:/#{1,2} .+/g,accent2:/#{3,} .+/g,accent3:/[- =]{3,}/g},sh:{accent1:/\b(echo|rm|ls|mkdir|rmdir|cd|find|cp|exit|pwd|exec|set|sed|awk)\b/g},php:{accent3:/\$\w+\b/g},perl:{"keyword,accent3":/\b(sub)\s*(\w+)\s*{/g},lua:{comment:/--.*\n/g},sql:{accent1:/\b(insert|into|create|table|update|select|from|where|values)\b/gi},redis:{accent1:/[A-Z]+/g}};a.javascript=a.js,a.stylus=a.css,a.yaml=a.markdown,a.shell=a.bash=a.sh,a.coffee=a.coffeescript=n(a.python,{accent1:a.js.accent1,accent2:/-&gt;/g,detect:/-&gt;/g}),a.django=a.jinja=n(a.html,{bracket:a.common.bracket,keyword:/\b(set|block|endblock|extends|if|endif)\b/g,accent3:/(\{\{.+\}\})/g}),a.markdown.comment=a.html.comment,a.css.detect=a.css.number,a.sql.comment=a.lua.comment,o.lang=a,e?window.hilite2=o:module.exports=o,"function"==typeof jQuery&&(jQuery.fn.hilite2=function(e){return this.each(function(){var t=jQuery(this);t.replaceWith(o(t.html(),t.attr("class"),e))})})}(true);moot.language={$code:"en",banned:"Banned account",banned2:"You are temporarily banned from posting on this forum for violating forum policies. Time left:",banned4:"You can no longer post on this forum.",warning:"Warning",profanity:"Profanity is not allowed on this forum. Continued abuse of this policy will result in being banned.",givebody:"Body cannot be empty.",show_old:"Show oldest replies",show_more:"Show more replies",show_new:"Show newest replies",start:"Start a new topic...",error:"Oops, an error. Please copy the post to clipboard, reload and try again. Sorry – we will fix this!",body:"Body text",admin:"Admin",someone:"Someone",title:"Title",writing:"is writing...",basic:"Basic (free)",subs:"Subscriptions",manage:"Manage",fullview:"Full view",link:"link",avatar:"Change avatar",seo_update:"The SEO pages will be updated within the hour",upgrade_link:"Upgrade",branding:"Branding",logo:"Logo",bgcolor:"Background color",brand_name:"Brand name",title:"Title",css:"CSS file",mootbrand:"Use Moot branding",sso:"Single Sign-On",apikey:"API key",apisecret:"Secret key",single:"single word",username_fail:"Use letters, numbers or dashes",bold:"bold",italics:"italics",monospaced:"monospaced",domain:"Forum URL",domaintip:"Full URL to the forums where users are pushed from the search results",learn:"Learn more...",ga:"Google Analytics Id",admins:"Administrators",adminstip:"One username per line",settings:"Settings",all:"All posts",anon_1:"anonymous",anon:"anonymous",badforum:"Invalid forum",c_acc1:"Your account now works on all sites using Moot",c_acc:"Account confirmed",c_email:"Email address updated",cancel:"Cancel",change:"Change",changepw:"Change password",close:"Close",collapse:"Collapse all",comm_count_1:"comment",comm_count_n:"comments",comment1:"Be the first to comment...",comment:"Comment...",edit:"edit",email:"Email",email_taken:"This email is taken",emailtip:"Your email is never shared",enter:"ctrl + enter",expired1:"We just sent you a new one. Please check your email.",expired:"This link has expired",feed:"My feed",forumname:"Forum name",forums:"Forums",help2:"post",help3:"quoted",help5:"code, language guessed",help6:"HTML code",in_forum:"in",invalid:"Invalid value",join:"Join Moot",later:"Later...",less:"less",like:"Like",likepost:"Like this post",loading:"Loading...",login:"Log in",login1:"Log in first",login_and:"Login and",logout:"Log out",mark:"Offensive or spam",mean:"Did you mean",name:"Display name",nametip:"Your real name, so people will recognize you",newcat:"New category",newpass:"New password",noresults:"No results for",nospam:"No spam on your forum!",notexist:"does not exist.",notify:"Notify me of new releases",ok:"ok",online:"Online",post:"Post",preview:"Preview",progress:["loading...","still working...","and working...","giving up"],reconnect:"Reconnecting...",removecat:"Remove. The posts are not removed",removepost:"Remove",reply:"Reply...",replybtn:"Reply",save:"Save changes",saved:"saved",search:"Search",select:"Select forum",setup:"Setup now",showing:"Showing",slogan:"Forums and commenting re-imagined",spam:"Spam",step1:"We have sent you a confirmation email. Your email is not updated before you complete this step!",step:"One more step",terms:"I agree to the <a>terms of service</a>.",thanks:"Thanks!",uname_len:"Type 6 characters or more",uname_taken:"This username is taken!",unametip:"This cannot be changed later",undo:"Undo",unlike:"Unlike",unspam:"Not spam",unver1:"Unverified account",unver2:"Please check your email to verify your account. Verified users can watch moots and receive email notifications. <a>Send a new verification code...</a>",unver3:"<a>Send a new</a> verification code to:",unver4:"Sent. Please check your inbox.",unver:"Unverified",unwall:"unwatch all",unwatch:"Unwatch",upgrade2:"Moot uses WebSockets or CORS for cross domain communication. All modern browsers above Opera 11 and IE7 work.",upgrade:"Please upgrade your browser",username_taken:"This username is taken",watch:"Watch for new replies",welcome1:"Please check your email to complete the registration. If you dont receive email within a minute or two, check your spam folder.",welcome2:"Please provide a Moot username",welcome:"Welcome to Moot",you:"You",now:"just now",months:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",min:"m",hour:"h",day:"d",week:"w"};